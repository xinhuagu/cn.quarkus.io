<!DOCTYPE html>
<html>





<head>
  <title>Quarkus - Testing Your Application - 1.11</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="default-src https://dpm.demdex.net; script-src 'self' 'unsafe-eval' 'sha256-ANpuoVzuSex6VhqpYgsG25OHWVA1I+F6aGU04LoI+5s=' 'sha256-ipy9P/3rZZW06mTLAR0EnXvxSNcnfSDPLDuh3kzbB1w=' js.bizographics.com https://www.redhat.com https://static.redhat.com assets.adobedtm.com jsonip.com https://ajax.googleapis.com https://www.googletagmanager.com https://www.google-analytics.com https://use.fontawesome.com https://app.mailjet.com http://www.youtube.com http://www.googleadservices.com https://googleads.g.doubleclick.net https://dpm.demdex.net https://giscus.app; style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; img-src 'self' *; media-src 'self'; frame-src https://www.googletagmanager.com https://www.youtube.com https://embed.restream.io https://app.mailjet.com https://giscus.app; base-uri 'none'; object-src 'none'; form-action 'none'; font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/1.11/guides/getting-started-testing" />
  <meta property="og:title" content="Quarkus - Testing Your Application - 1.11" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/getting-started-testing">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/goan.js" type="text/javascript"></script>
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
</head>

<body class="guides">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  

<div class="grid-wrapper communitysite">
  <div class="grid__item width-12-12">The <a href="https://quarkus.io">English version of quarkus.io</a> is the official project site. Translated sites are community supported on a best-effort basis.</div>
</div>


  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
  <div class="container">
    <div class="logo-wrapper">
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
    </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">关于<i class="fas fa-chevron-down">
</i></span>
        <ul class="submenu">
          <li><a href="/about" class="">QUARKUS是什么？</a></li>
          <li><a href="/container-first" class="">容器优先 </a></li>
          <li><a href="/continuum" class="">响应式</a></li>
          <li><a href="/developer-joy" class="">开发者的乐趣 </a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES 原生</a></li>
          <li><a href="/standards" class="">标准</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">学习 <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">入门</a></li>
          <li><a href="/guides" class="active" >指南</a></li>
          <li><a href="/qtips" class="">"Q" TIP视频</a></li>          
          <li><a href="/books" class="">书籍</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">社区 <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">支持</a></li>
          <li><a href="/blog" class="" >博客</a></li>
          <li><a href="/discussion" class="">讨论</a></li>
          <li><a href="/insights" class="" >播客</a></li>
          <li><a href="/events" class="">活动</a></li>
          <li><a href="/newsletter" class="">新闻</a></li>
          <li><a href="/publications" class="">发表</a></li>
          <li><a href="/awards" class="">获奖</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary
white">开始写代码</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://es.quarkus.io/">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/">日本語</a></li>
          </ul>
      </li>
    </ul>
  </div>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    



<div class="full-width-version-bg grey align-self">
  <div class="grid-wrapper">
    <div class="grid__item width-6-12">
      <p class="returnlink"><i class="fas fa-angle-left"></i><a href="/version/1.11/guides/">返回指南目录</a></p>
    </div>
    <div class="grid__item width-6-12 align-self-center text-right hide-mobile">
      <label id="guide-version-label">选择指南版本</label>
      <select id="guide-version-dropdown">
        
      
        
        
        
        
          
        <option value="main" >Main - SNAPSHOT</option>
        
        
      
        
        
        
        
          
        <option value="latest" >2.11 - Latest</option>
        
        
      
        
        
        
        
          
        <option value="2.7" >2.7</option>
        
        
      
        
        
        
        
          
        <option value="2.2" >2.2</option>
        
        
      
        
        
        
        
          
        <option value="1.11" selected>1.11</option>
        
        
      
    
      </select>
    </div>
  </div>
</div>

<div class="grid-wrapper guide">
  <div class="grid__item width-12-12 width-12-12-mobile">
    <h1 class="text-caps">Quarkus - Testing Your Application </h1>
  </div>
  <div class="width-12-12">
    <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#先决条件">1. 先决条件</a></li>
<li><a href="#应用结构">2. 应用结构</a></li>
<li><a href="#解决方案">3. 解决方案</a></li>
<li><a href="#对jvm模式中基于http的测试的回顾">4. 对JVM模式中基于HTTP的测试的回顾</a>
<ul class="sectlevel2">
<li><a href="#控制测试端口">4.1. 控制测试端口</a></li>
<li><a href="#控制http交互超时时间">4.2. 控制HTTP交互超时时间</a></li>
<li><a href="#注入uri">4.3. 注入URI</a></li>
</ul>
</li>
<li><a href="#测试特定的节点">5. 测试特定的节点</a>
<ul class="sectlevel2">
<li><a href="#testhttpresource">5.1. TestHTTPResource</a></li>
<li><a href="#restassured">5.2. RESTassured</a></li>
</ul>
</li>
<li><a href="#注入测试">6. 注入测试</a></li>
<li><a href="#在测试中使用拦截器">7. 在测试中使用拦截器</a></li>
<li><a href="#测试与事务">8. 测试与事务</a></li>
<li><a href="#通过quarkustestcallback来增强">9. 通过QuarkusTest*Callback来增强</a></li>
<li><a href="#testing_different_profiles">10. 测试不同的Profiles</a>
<ul class="sectlevel2">
<li><a href="#编写profile">10.1. 编写Profile</a></li>
</ul>
</li>
<li><a href="#mock-support">11. Mock Support</a>
<ul class="sectlevel2">
<li><a href="#cdi-alternative-机制">11.1. CDI <code>@Alternative</code> 机制。</a></li>
<li><a href="#quarkus_mock">11.2. 使用QuarkusMock进行mock</a></li>
<li><a href="#使用panache-mock">11.3. 使用Panache mock</a></li>
</ul>
</li>
<li><a href="#测试安全性">12. 测试安全性</a></li>
<li><a href="#quarkus-test-resource">13. 在Quarkus应用程序启动之前启动服务</a></li>
<li><a href="#本地可执行程序测试">14. 本地可执行程序测试</a></li>
<li><a href="#test-from-ide">15. 从IDE中运行 <code>@QuarkusTest</code></a>
<ul class="sectlevel2">
<li><a href="#eclipse-separate-jre-definition">15.1. Eclipse separate JRE definition</a></li>
<li><a href="#vscode-run-with-配置">15.2. VSCode "run with "配置</a></li>
<li><a href="#intellij-junit-template">15.3. IntelliJ JUnit template</a></li>
</ul>
</li>
</ul></div>
    <div>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>学习如何测试您的Quarkus应用程序。本指南包括：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在JVM模式下测试</p>
</li>
<li>
<p>在本地模式下测试</p>
</li>
<li>
<p>将资源注入测试中</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="先决条件"><a class="anchor" href="#先决条件"></a>1. 先决条件</h2>
<div class="sectionbody">
<div class="paragraph">
<p>要完成这个指南，你需要：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>less than 15 minutes</p>
</li>
<li>
<p>一个编辑器</p>
</li>
<li>
<p>JDK 1.8+ installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
<li>
<p>Apache Maven 3.6.2+</p>
</li>
<li>
<p>The completed greeter application from the <a href="getting-started">Getting Started Guide</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="应用结构"><a class="anchor" href="#应用结构"></a>2. 应用结构</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在本指南中，我们对作为入门指南的一部分而创建的初始测试进行扩展。我们涵盖了注入测试以及如何测试本地可执行文件。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="解决方案"><a class="anchor" href="#解决方案"></a>3. 解决方案</h2>
<div class="sectionbody">
<div class="paragraph">
<p>我们建议您按照下一节的说明逐步创建应用程序。然而，您可以直接转到已完成的示例。</p>
</div>
<div class="paragraph">
<p>克隆 Git 仓库: <code>git clone <a href="https://github.com/quarkusio/quarkus-quickstarts.git" class="bare">https://github.com/quarkusio/quarkus-quickstarts.git</a></code> ，或下载一个 <a href="https://github.com/quarkusio/quarkus-quickstarts/archive/main.zip">存档</a> 。</p>
</div>
<div class="paragraph">
<p>该解决方案位于 <code>getting-started-testing</code> <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/main/getting-started-testing">目录</a>中。</p>
</div>
<div class="paragraph">
<p>本指南假设您已经准备好了 <code>getting-started</code> 目录中的应用。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="对jvm模式中基于http的测试的回顾"><a class="anchor" href="#对jvm模式中基于http的测试的回顾"></a>4. 对JVM模式中基于HTTP的测试的回顾</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have started from the Getting Started example you should already have a completed test, including the correct <code>pom.xml</code> setup.</p>
</div>
<div class="paragraph">
<p>In the <code>pom.xml</code> file you should see 2 test dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-junit5&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.rest-assured&lt;/groupId&gt;
    &lt;artifactId&gt;rest-assured&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>quarkus-junit5</code> 是测试所必需的，因为它提供 <code>@QuarkusTest</code> 注解来控制测试框架。而 <code>rest-assured</code> 不是必需的，但它是测试HTTP节点的一种便捷方式，我们还集成对自动设置正确URL的支持，因此不需要配置。</p>
</div>
<div class="paragraph">
<p>因为我们使用的是JUnit 5，所以必须设置 <a href="https://maven.apache.org/surefire/maven-surefire-plugin/">Surefire Maven插件</a> 的版本，因为默认版本不支持Junit 5：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
    &lt;version&gt;${surefire-plugin.version}&lt;/version&gt;
    &lt;configuration&gt;
       &lt;systemPropertyVariables&gt;
          &lt;java.util.logging.manager&gt;org.jboss.logmanager.LogManager&lt;/java.util.logging.manager&gt;
          &lt;maven.home&gt;${maven.home}&lt;/maven.home&gt;
       &lt;/systemPropertyVariables&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>我们还设置了 <code>java.util.logging.manager</code> 系统属性，以确保测试使用正确的日志管理器。同时设置 <code>maven.home</code> 属性，以确保 <code>${maven.home}/conf/settings.xml</code> 的自定义配置被设置（如果有的话）。</p>
</div>
<div class="paragraph">
<p>该项目还应该包含一个简单的测试：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.getting.started.testing;

import io.quarkus.test.junit.QuarkusTest;
import org.junit.jupiter.api.Test;

import java.util.UUID;

import static io.restassured.RestAssured.given;
import static org.hamcrest.CoreMatchers.is;

@QuarkusTest
public class GreetingResourceTest {

    @Test
    public void testHelloEndpoint() {
        given()
          .when().get("/hello")
          .then()
             .statusCode(200)
             .body(is("hello"));
    }

    @Test
    public void testGreetingEndpoint() {
        String uuid = UUID.randomUUID().toString();
        given()
          .pathParam("name", uuid)
          .when().get("/hello/greeting/{name}")
          .then()
            .statusCode(200)
            .body(is("hello " + uuid));
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>该测试使用HTTP来直接测试我们的REST节点。当运行测试时，应用程序将在测试运行前被启动。</p>
</div>
<div class="sect2">
<h3 id="控制测试端口"><a class="anchor" href="#控制测试端口"></a>4.1. 控制测试端口</h3>
<div class="paragraph">
<p>虽然Quarkus默认会监听端口 <code>8080</code> ，但当运行测试时，它会默认设为 <code>8081</code> 。这允许您在运行测试的同时让应用程序并行运行。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">改变测试端口</div>
<div class="paragraph">
<p>您可以通过 <code>quarkus.http.test-port</code> 和 <code>quarkus.http.test-ssl-port</code> 来配置用于HTTP和HTTPS测试的端口：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">quarkus.http.test-port=8083
quarkus.http.test-ssl-port=8446</code></pre>
</div>
</div>
<div class="paragraph">
<p>设置为 <code>0</code> 则会使用随机端口（由操作系统分配）。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Quarkus还提供了RestAssured集成用以在测试运行前更新RestAssured使用的默认端口，因而不需要额外的配置。</p>
</div>
</div>
<div class="sect2">
<h3 id="控制http交互超时时间"><a class="anchor" href="#控制http交互超时时间"></a>4.2. 控制HTTP交互超时时间</h3>
<div class="paragraph">
<p>当在您的测试中使用REST Assured时，连接和响应超时默认设置为30秒。可以通过 <code>quarkus.http.test-timeout</code> 属性覆盖该设置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">quarkus.http.test-timeout=10s</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="注入uri"><a class="anchor" href="#注入uri"></a>4.3. 注入URI</h3>
<div class="paragraph">
<p>也可以直接将URL注入测试中，从而可以更容易的使用不同的客户端。可通过 <code>@TestHTTPResource</code> 注解完成。</p>
</div>
<div class="paragraph">
<p>让我们写一个简单的测试来演示如何加载一些静态资源。首先创建一个简单的HTML文件 <code>src/main/resources/META-INF/resources/index.html</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Testing Guide&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        Information about testing
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>我们将创建一个简单的测试以确保这个文件被正确的加载：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.getting.started.testing;

import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.net.URL;
import java.nio.charset.StandardCharsets;

import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;

import io.quarkus.test.common.http.TestHTTPResource;
import io.quarkus.test.junit.QuarkusTest;

@QuarkusTest
public class StaticContentTest {

    @TestHTTPResource("index.html") <i class="conum" data-value="1"></i><b>(1)</b>
    URL url;

    @Test
    public void testIndexHtml() throws Exception {
        try (InputStream in = url.openStream()) {
            String contents = readStream(in);
            Assertions.assertTrue(contents.contains("&lt;title&gt;Testing Guide&lt;/title&gt;"));
        }
    }

    private static String readStream(InputStream in) throws IOException {
        byte[] data = new byte[1024];
        int r;
        ByteArrayOutputStream out = new ByteArrayOutputStream();
        while ((r = in.read(data)) &gt; 0) {
            out.write(data, 0, r);
        }
        return new String(out.toByteArray(), StandardCharsets.UTF_8);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>该注解允许您将URL直接注入为Quarkus实例，注解的值将是URL的路径</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>目前为止 <code>@TestHTTPResource</code> 允许您注入 <code>URI</code> 、 <code>URL</code> 以及 <code>String</code> 的URL表示。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="测试特定的节点"><a class="anchor" href="#测试特定的节点"></a>5. 测试特定的节点</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RESTassured和 <code>@TestHTTPResource</code> 都允许您指定要测试的节点类，而不是对路径硬编码。这目前支持JAX-RS节点、Servlets和Reactive Routes。这使您更容易查看给定的测试用例到底在测试哪些节点。</p>
</div>
<div class="paragraph">
<p>为了演示这些例子的目的，这里将假设我们有一个类似于下面的节点：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("/hello")
public class GreetingResource {

    @GET
    @Produces(MediaType.TEXT_PLAIN)
    public String hello() {
        return "hello";
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
目前不支持使用 <code>@ApplicationPath()</code> 注解来设置 JAX-RS 上下文路径。如果您想要一个自定义的上下文路径，请使用 <code>quarkus.resteasy.path</code> 代替。
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="testhttpresource"><a class="anchor" href="#testhttpresource"></a>5.1. TestHTTPResource</h3>
<div class="paragraph">
<p>您可以使用 <code>io.quarkus.test.common.http.TestHTTPEndpoint</code> 注释来指定节点路径，该路径会从提供的节点中提取。如果您还为 <code>TestHTTPResource</code> 节点指定了另外的值，它将被附加到节点路径后。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.getting.started.testing;

import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.net.URL;
import java.nio.charset.StandardCharsets;

import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;

import io.quarkus.test.common.http.TestHTTPEndpoint;
import io.quarkus.test.common.http.TestHTTPResource;
import io.quarkus.test.junit.QuarkusTest;

@QuarkusTest
public class StaticContentTest {

    @TestHTTPEndpoint(GreetingResource.class)  <i class="conum" data-value="1"></i><b>(1)</b>
    @TestHTTPResource
    URL url;

    @Test
    public void testIndexHtml() throws Exception {
        try (InputStream in = url.openStream()) {
            String contents = readStream(in);
            Assertions.assertTrue(contents.equals("hello"));
        }
    }

    private static String readStream(InputStream in) throws IOException {
        byte[] data = new byte[1024];
        int r;
        ByteArrayOutputStream out = new ByteArrayOutputStream();
        while ((r = in.read(data)) &gt; 0) {
            out.write(data, 0, r);
        }
        return new String(out.toByteArray(), StandardCharsets.UTF_8);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>因为 <code>GreetingResource</code> 用到了注解 <code>@Path("/hello")</code> ，注入的URL会以 <code>/hello</code> 结束。</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="restassured"><a class="anchor" href="#restassured"></a>5.2. RESTassured</h3>
<div class="paragraph">
<p>为了控制RESTassured基础路径（即作为每个请求根路径的默认路径），您可以使用 <code>io.quarkus.test.common.http.TestHTTPEndpoint</code> 注解。可以在类或方法层面上使用。为了测试greeting资源类，我们可以这样做：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.getting.started.testing;

import io.quarkus.test.junit.QuarkusTest;
import io.quarkus.test.common.http.TestHTTPEndpoint;
import org.junit.jupiter.api.Test;

import java.util.UUID;

import static io.restassured.RestAssured.given;
import static org.hamcrest.CoreMatchers.is;

@QuarkusTest
@TestHTTPEndpoint(GreetingResource.class) <i class="conum" data-value="1"></i><b>(1)</b>
public class GreetingResourceTest {

    @Test
    public void testHelloEndpoint() {
        given()
          .when().get()    <i class="conum" data-value="2"></i><b>(2)</b>
          .then()
             .statusCode(200)
             .body(is("hello"));
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>这将使RESTAssured在所有请求之前加上 <code>/hello</code> 。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>注意我们不需要在此指定路径，因为 <code>/hello</code> 是这个测试的默认路径</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="注入测试"><a class="anchor" href="#注入测试"></a>6. 注入测试</h2>
<div class="sectionbody">
<div class="paragraph">
<p>到目前为止，我们只涉及了通过HTTP节点测试应用程序的集成式测试，但如果我们想做单元测试并直接测试我们的Bean又该怎么办？</p>
</div>
<div class="paragraph">
<p>Quarkus支持这种方式。它允许使用 <code>@Inject</code> 注解来将CDI Bean注入您的测试中（事实上，Quarkus中的测试是完整的CDI Bean，所以您可以使用所有的CDI功能）。让我们创建一个简单的测试，直接测试greeting服务，而非使用HTTP：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.getting.started.testing;

import javax.inject.Inject;

import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;

import io.quarkus.test.junit.QuarkusTest;

@QuarkusTest
public class GreetingServiceTest {

    @Inject <i class="conum" data-value="1"></i><b>(1)</b>
    GreetingService service;

    @Test
    public void testGreetingService() {
        Assertions.assertEquals("hello Quarkus", service.greeting("Quarkus"));
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>GreetingService</code> bean将被注入到测试类中</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="在测试中使用拦截器"><a class="anchor" href="#在测试中使用拦截器"></a>7. 在测试中使用拦截器</h2>
<div class="sectionbody">
<div class="paragraph">
<p>如上所述，Quarkus测试实际上是完整的CDI Bean，因此您可以自由的使用CDI拦截器。举个例子，如果您想让测试方法在事务上下文中运行，您可以将 <code>@Transactional</code> 注解加到该方法上，之后事务拦截器将会处理。</p>
</div>
<div class="paragraph">
<p>In addition to this you can also create your own test stereotypes. For example we could create a <code>@TransactionalQuarkusTest</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@QuarkusTest
@Stereotype
@Transactional
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
public @interface TransactionalQuarkusTest {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果我们将这个注解应用于测试类，那它就类似于我们同时应用了 <code>@QuarkusTest</code> 和 <code>@Transactional</code> 注解一样，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@TransactionalQuarkusTest
public class TestStereotypeTestCase {

    @Inject
    UserTransaction userTransaction;

    @Test
    public void testUserTransaction() throws Exception {
        Assertions.assertEquals(Status.STATUS_ACTIVE, userTransaction.getStatus());
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="测试与事务"><a class="anchor" href="#测试与事务"></a>8. 测试与事务</h2>
<div class="sectionbody">
<div class="paragraph">
<p>您可以在测试中使用标准的Quarkus <code>@Transactional</code> 注解，但这意味着您的测试对数据库的改变将是持久的。如果您想在测试结束时回滚所做的任何改变，您可以使用 <code>io.quarkus.test.TestTransaction</code> 注释。这将在一个事务中运行测试方法，但一旦测试方法完成，事务就会回滚从而以恢复所有数据库变化。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="通过quarkustestcallback来增强"><a class="anchor" href="#通过quarkustestcallback来增强"></a>9. 通过QuarkusTest*Callback来增强</h2>
<div class="sectionbody">
<div class="paragraph">
<p>作为拦截器的替代或补充，您可以通过实现以下回调接口来增强 <strong>所有</strong> 的 <code>@QuarkusTest</code> 类：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>io.quarkus.test.junit.callback.QuarkusTestBeforeClassCallback</code></p>
</li>
<li>
<p><code>io.quarkus.test.junit.callback.QuarkusTestAfterConstructCallback</code></p>
</li>
<li>
<p><code>io.quarkus.test.junit.callback.QuarkusTestBeforeEachCallback</code></p>
</li>
<li>
<p><code>io.quarkus.test.junit.callback.QuarkusTestAfterEachCallback</code></p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<code>io.quarkus.test.junit.callback.QuarkusTestBeforeAllCallback</code> has been deprecated in favor of <code>io.quarkus.test.junit.callback.QuarkusTestAfterConstructCallback</code> and will be removed in future releases of Quarkus
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>这种回调实现必须作为java "服务提供者(service provider) "注册，从而被 <code>java.util.ServiceLoader</code> 来加载。</p>
</div>
<div class="paragraph">
<p>例如下面的回调例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.getting.started.testing;

import io.quarkus.test.junit.callback.QuarkusTestBeforeEachCallback;
import io.quarkus.test.junit.callback.QuarkusTestMethodContext;

public class MyQuarkusTestBeforeEachCallback implements QuarkusTestBeforeEachCallback {

    @Override
    public void beforeEach(QuarkusTestMethodContext context) {
        System.out.println("Executing " + context.getTestMethod());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>该回调类必须通过 <code>src/main/resources/META-INF/services/io.quarkus.test.junit.callback.QuarkusTestBeforeEachCallback</code> 注册，具体如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">org.acme.getting.started.testing.MyQuarkusTestBeforeEachCallback</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
可以从测试类或方法中读取注解，从而控制回调应做什么。
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
虽然可以使用JUnit Jupiter回调接口，如 <code>BeforeEachCallback</code> ，但您可能会遇到类加载问题，因为Quarkus必须在一个JUnit无法感知的自定义类加载器中运行测试。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing_different_profiles"><a class="anchor" href="#testing_different_profiles"></a>10. 测试不同的Profiles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So far in all our examples we only start Quarkus once for all tests. Before the first test is run Quarkus will boot, then all tests will run, then Quarkus will shutdown at the end. This makes for a very fast testing experience however it is a bit limited as you can&#8217;t test different configurations.</p>
</div>
<div class="paragraph">
<p>为了解决这个问题，Quarkus支持测试profile。如果一个测试有一个与之前运行的测试不同的profile，那么Quarkus将被停止，并在运行对应的测试之前使用新的profile启动。这显然会有些许变慢，因为它在测试时间上增加了一个停止/启动周期，但同时也提供了很大的灵活性。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In order to reduce the amount of times Quarkus needs to restart it is recommended that you place all tests that need a specific profile into their own package, and then run tests alphabetically.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="编写profile"><a class="anchor" href="#编写profile"></a>10.1. 编写Profile</h3>
<div class="paragraph">
<p>为了实现一个测试profile，我们需要实现 <code>io.quarkus.test.junit.QuarkusTestProfile</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.getting.started.testing;

import java.util.Collections;
import java.util.List;
import java.util.Map;
import java.util.Set;

import io.quarkus.test.junit.QuarkusTestProfile;
import io.quarkus.test.junit.QuarkusTestProfile.TestResourceEntry;

public class MockGreetingProfile implements QuarkusTestProfile {

    @Override
    public Map&lt;String, String&gt; getConfigOverrides() { <i class="conum" data-value="1"></i><b>(1)</b>
        return Collections.singletonMap("quarkus.resteasy.path","/api");
    }

    @Override
    public Set&lt;Class&lt;?&gt;&gt; getEnabledAlternatives() { <i class="conum" data-value="2"></i><b>(2)</b>
        return Collections.singleton(MockGreetingService.class);
    }


    @Override
    public String getConfigProfile() { <i class="conum" data-value="3"></i><b>(3)</b>
        return "test";
    }

    @Override
    public List&lt;TestResourceEntry&gt; testResources() { <i class="conum" data-value="4"></i><b>(4)</b>
        return Collections.singletonList(new TestResourceEntry(CustomWireMockServerManager.class));
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This method allows us to override configuration properties. Here we are changing the JAX-RS root path.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This method allows us to enable CDI <code>@Alternative</code> beans. This makes it easy to mock out certain beans functionality.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This can be used to change the config profile. As this default is <code>test</code> this does nothing, but is included for completeness.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>This method allows us to apply <strong>additional</strong> <code>QuarkusTestResourceLifecycleManager</code> classes, specific for this profile only. If this method is not overridden, then only the <code>QuarkusTestResourceLifecycleManager</code> classes enabled via the <code>@QuarkusTestResource</code> class annotation will be used for the tests using this profile (which is the same behavior as tests that don&#8217;t use a profile at all).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now we have defined our profile we need to include it on our test class. We do this with <code>@TestProfile(MockGreetingProfile.class)</code>.</p>
</div>
<div class="paragraph">
<p>All the test profile config is stored in a single class, which makes it easy to tell if the previous test ran with the same configuration.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mock-support"><a class="anchor" href="#mock-support"></a>11. Mock Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus支持使用两种不同的方法来mock对象。您可以使用CDI alternatives来mock出所有测试类的Bean，也可以使用 <code>QuarkusMock</code> 来mock出每个测试类的Bean。</p>
</div>
<div class="sect2">
<h3 id="cdi-alternative-机制"><a class="anchor" href="#cdi-alternative-机制"></a>11.1. CDI <code>@Alternative</code> 机制。</h3>
<div class="paragraph">
<p>要使用这个方法，只需用 <code>src/test/java</code> 目录中的一个类来覆盖您想mock的Bean，并在Bean上加上 <code>@Alternative</code> 和 <code>@Priority(1)</code> 注解。另外，也可以使用 <code>io.quarkus.test.Mock</code> stereotype注释。这个内置的stereotype声明了 <code>@Alternative</code> 、 <code>@Priority(1)</code> 和 <code>@Dependent</code> 。例如，如果我有以下的服务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class ExternalService {

    public String service() {
        return "external";
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>我可以在 <code>src/test/java</code> 中用以下类来mock它：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Mock
@ApplicationScoped <i class="conum" data-value="1"></i><b>(1)</b>
public class MockExternalService extends ExternalService {

    @Override
    public String service() {
        return "mock";
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>对 <code>@Mock</code> stereotype上声明的 <code>@Dependent</code> 范围的覆盖。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>注意，alternative要放置于 <code>src/test/java</code> 目录中而不是 <code>src/main/java</code> ，否则它将不仅仅只是在测试时生效。</p>
</div>
<div class="paragraph">
<p>Note that at present this approach does not work with native image testing, as this would required the test alternatives to be baked into the native image.</p>
</div>
</div>
<div class="sect2">
<h3 id="quarkus_mock"><a class="anchor" href="#quarkus_mock"></a>11.2. 使用QuarkusMock进行mock</h3>
<div class="paragraph">
<p><code>io.quarkus.test.junit.QuarkusMock</code> 类可以被用来临时mock任何正常scope的bean。如果您在 <code>@BeforeAll</code> 方法中使用这个方法，mock将对当前类的所有测试生效，而如果您在测试方法中使用这个方法，mock将只在当前测试方法范围内生效。</p>
</div>
<div class="paragraph">
<p>该方法可以用于任何正常scope的CDI Bean（例如： <code>@ApplicationScoped</code> , <code>@RequestScoped</code> 等，基本上是除了 <code>@Singleton</code> 和 <code>@Dependent</code> 以外的scope ）。</p>
</div>
<div class="paragraph">
<p>示例用法如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@QuarkusTest
public class MockTestCase {

    @Inject
    MockableBean1 mockableBean1;

    @Inject
    MockableBean2 mockableBean2;

    @BeforeAll
    public static void setup() {
        MockableBean1 mock = Mockito.mock(MockableBean1.class);
        Mockito.when(mock.greet("Stuart")).thenReturn("A mock for Stuart");
        QuarkusMock.installMockForType(mock, MockableBean1.class);  <i class="conum" data-value="1"></i><b>(1)</b>
    }

    @Test
    public void testBeforeAll() {
        Assertions.assertEquals("A mock for Stuart", mockableBean1.greet("Stuart"));
        Assertions.assertEquals("Hello Stuart", mockableBean2.greet("Stuart"));
    }

    @Test
    public void testPerTestMock() {
        QuarkusMock.installMockForInstance(new BonjourGreeter(), mockableBean2); <i class="conum" data-value="2"></i><b>(2)</b>
        Assertions.assertEquals("A mock for Stuart", mockableBean1.greet("Stuart"));
        Assertions.assertEquals("Bonjour Stuart", mockableBean2.greet("Stuart"));
    }

    @ApplicationScoped
    public static class MockableBean1 {

        public String greet(String name) {
            return "Hello " + name;
        }
    }

    @ApplicationScoped
    public static class MockableBean2 {

        public String greet(String name) {
            return "Hello " + name;
        }
    }

    public static class BonjourGreeter extends MockableBean2 {
        @Override
        public String greet(String name) {
            return "Bonjour " + name;
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>由于注入的实例在这里不可用，我们使用了 <code>installMockForType</code> ，这个mock用在于所有两个测试方法中</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>我们使用 <code>installMockForInstance</code> 以取代注入的bean，它在整个测试方法的持续时间内生效。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>请注意，这里并不依赖Mockito，您可以使用任何您喜欢的mocking库，甚至可以手动覆盖对象以提供您需要的行为。</p>
</div>
<div class="sect3">
<h4 id="使用-injectmock-进行进一步简化"><a class="anchor" href="#使用-injectmock-进行进一步简化"></a>11.2.1. 使用 <code>@InjectMock</code> 进行进一步简化</h4>
<div class="paragraph">
<p>基于 <code>QuarkusMock</code> 所提供的功能，Quarkus还允许用户很容易地利用 <a href="https://site.mockito.org/">Mockito</a> 来mock <code>QuarkusMock</code> 所支持的bean。该功能可以通过 <code>@io.quarkus.test.junit.mockito.InjectMock</code> 注解来实现，该注解可以通过添加 <code>quarkus-junit5-mockito</code> 依赖而导入。</p>
</div>
<div class="paragraph">
<p>使用 <code>@InjectMock</code> ，前面的例子可以写成下面形式：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@QuarkusTest
public class MockTestCase {

    @InjectMock
    MockableBean1 mockableBean1; <i class="conum" data-value="1"></i><b>(1)</b>

    @InjectMock
    MockableBean2 mockableBean2;

    @BeforeEach
    public void setup() {
        Mockito.when(mockableBean1.greet("Stuart")).thenReturn("A mock for Stuart"); <i class="conum" data-value="2"></i><b>(2)</b>
    }

    @Test
    public void firstTest() {
        Assertions.assertEquals("A mock for Stuart", mockableBean1.greet("Stuart"));
        Assertions.assertEquals(null, mockableBean2.greet("Stuart")); <i class="conum" data-value="3"></i><b>(3)</b>
    }

    @Test
    public void secondTest() {
        Mockito.when(mockableBean2.greet("Stuart")).thenReturn("Bonjour Stuart"); <i class="conum" data-value="4"></i><b>(4)</b>
        Assertions.assertEquals("A mock for Stuart", mockableBean1.greet("Stuart"));
        Assertions.assertEquals("Bonjour Stuart", mockableBean2.greet("Stuart"));
    }

    @ApplicationScoped
    public static class MockableBean1 {

        public String greet(String name) {
            return "Hello " + name;
        }
    }

    @ApplicationScoped
    public static class MockableBean2 {

        public String greet(String name) {
            return "Hello " + name;
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@InjectMock</code> 可以生成一个mock并使其在测试类的所有测试方法中可用（其他测试 类*不受* 此影响）</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>mockableBean1</code> 被mockito配置并可以为类的每个测试方法所用</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>由于 <code>mockableBean2</code> mock还没有被配置，它将返回默认的Mockito响应。</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>在这个测试中， <code>mockableBean2</code> 进行了配置，所以它返回配置好的响应。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>尽管上面的测试很好地展示了 <code>@InjectMock</code> 的能力，但它并不能很好地表示一个真实的测试案例。在一个真实的测试案例中，我们很可能会配置一个mock，然后测试一个使用了mocked Bean的Bean。下面是一个例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@QuarkusTest
public class MockGreetingServiceTest {

    @InjectMock
    GreetingService greetingService;

    @Test
    public void testGreeting() {
        when(greetingService.greet()).thenReturn("hi");
        given()
                .when().get("/greeting")
                .then()
                .statusCode(200)
                .body(is("hi")); <i class="conum" data-value="1"></i><b>(1)</b>
    }

    @Path("greeting")
    public static class GreetingResource {

        final GreetingService greetingService;

        public GreetingResource(GreetingService greetingService) {
            this.greetingService = greetingService;
        }

        @GET
        @Produces("text/plain")
        public String greet() {
            return greetingService.greet();
        }
    }

    @ApplicationScoped
    public static class GreetingService {
        public String greet(){
            return "hello";
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>由于我们将 <code>greetingService</code> 配置为一个mock，那么在使用了 <code>GreetingService</code> Bean的 <code>GreetingResource</code> 中，我们得到的是mock的响应，而不是正常的 <code>GreetingService</code> Bean的响应</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="通过-injectspy-用spies来代替mocks"><a class="anchor" href="#通过-injectspy-用spies来代替mocks"></a>11.2.2. 通过 <code>@InjectSpy</code> 用Spies来代替Mocks</h4>
<div class="paragraph">
<p>基于 <code>InjectMock</code> 所提供的功能，Quarkus还允许用户很容易利用 <a href="https://site.mockito.org/">Mockito</a> 来对 <code>QuarkusMock</code> 所支持的bean进行spy操作。这个功能可以通过 <code>@io.quarkus.test.junit.mockito.InjectSpy</code> 注解来实现，该注解通过 <code>quarkus-junit5-mockito</code> 依赖导入。</p>
</div>
<div class="paragraph">
<p>有时在测试时您只需要验证某个逻辑路径，或者您只想对某一个方法的响应进行stub，同时仍保持执行Spied clone上的其他方法。关于Spy部分mock的更多细节，请参见 <a href="https://javadoc.io/doc/org.mockito/mockito-core/latest/org/mockito/Mockito.html#spy-T-">Mockito文档</a> 。在这两种情况下，推荐使用针对对象的Spy。使用 <code>@InjectSpy</code> ，前面的例子可以写成这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@QuarkusTest
public class SpyGreetingServiceTest {

    @InjectSpy
    GreetingService greetingService;

    @Test
    public void testDefaultGreeting() {
        given()
                .when().get("/greeting")
                .then()
                .statusCode(200)
                .body(is("hello"));

        Mockito.verify(greetingService, Mockito.times(1)).greet(); <i class="conum" data-value="1"></i><b>(1)</b>
    }

    @Test
    public void testOverrideGreeting() {
        when(greetingService.greet()).thenReturn("hi"); <i class="conum" data-value="2"></i><b>(2)</b>
        given()
                .when().get("/greeting")
                .then()
                .statusCode(200)
                .body(is("hi")); <i class="conum" data-value="3"></i><b>(3)</b>
    }

    @Path("greeting")
    public static class GreetingResource {

        final GreetingService greetingService;

        public GreetingResource(GreetingService greetingService) {
            this.greetingService = greetingService;
        }

        @GET
        @Produces("text/plain")
        public String greet() {
            return greetingService.greet();
        }
    }

    @ApplicationScoped
    public static class GreetingService {
        public String greet(){
            return "hello";
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>我们没有覆盖这个值，而只是想确保我们的 <code>GreetingService</code> 上的greet方法被这个测试所调用。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>这里我们令Spy返回 "hi "而不是 "hello"。当 <code>GreetingResource</code> 向 <code>GreetingService</code> 请求greeting时，我们得到的是mock的响应，而不是正常的 <code>GreetingService</code> Bean的响应</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>这里我们正在验证从Spy那里得到了mock响应。</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="使用-injectmock-与-restclient"><a class="anchor" href="#使用-injectmock-与-restclient"></a>11.2.3. 使用 <code>@InjectMock</code> 与 <code>@RestClient</code></h4>
<div class="paragraph">
<p><code>@RegisterRestClient</code> 在运行时注册了rest-client的实现，并且由于bean需要保证使用了一个正常的scope，您必须使用 <code>@ApplicationScoped</code> 来注释您的接口。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("/")
@ApplicationScoped
@RegisterRestClient
public interface GreetingService {

    @GET
    @Path("/hello")
    @Produces(MediaType.TEXT_PLAIN)
    String hello();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于测试类，这里有一个例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@QuarkusTest
public class GreetingResourceTest {

    @InjectMock
    @RestClient <i class="conum" data-value="1"></i><b>(1)</b>
    GreetingService greetingService;

    @Test
    public void testHelloEndpoint() {
        Mockito.when(greetingService.hello()).thenReturn("hello from mockito");

        given()
          .when().get("/hello")
          .then()
             .statusCode(200)
             .body(is("hello from mockito"));
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>这里表示这个注入点使用了 <code>RestClient</code> 的实例。</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="使用panache-mock"><a class="anchor" href="#使用panache-mock"></a>11.3. 使用Panache mock</h3>
<div class="paragraph">
<p>If you are using the <code>quarkus-hibernate-orm-panache</code> or <code>quarkus-mongodb-panache</code> extensions, check out the <a href="hibernate-orm-panache#mocking">Hibernate ORM with Panache Mocking</a> and <a href="mongodb-panache#mocking">MongoDB with Panache Mocking</a> documentation for the easiest way to mock your data access.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="测试安全性"><a class="anchor" href="#测试安全性"></a>12. 测试安全性</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are using Quarkus Security, check out the <a href="security-testing">Testing Security</a> section for information on how to easily test security features of the application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quarkus-test-resource"><a class="anchor" href="#quarkus-test-resource"></a>13. 在Quarkus应用程序启动之前启动服务</h2>
<div class="sectionbody">
<div class="paragraph">
<p>一个很常见的需求是在Quarkus应用程序启动测试之前，启动一些您的Quarkus应用程序所依赖的服务。为了解决这个需求，Quarkus提供了 <code>@io.quarkus.test.common.QuarkusTestResource</code> 和 <code>io.quarkus.test.common.QuarkusTestResourceLifecycleManager</code> 。</p>
</div>
<div class="paragraph">
<p>By simply annotating any test in the test suite with <code>@QuarkusTestResource</code>, Quarkus will run the corresponding <code>QuarkusTestResourceLifecycleManager</code> before any tests are run. A test suite is also free to utilize multiple <code>@QuarkusTestResource</code> annotations, in which case all the corresponding <code>QuarkusTestResourceLifecycleManager</code> objects will be run before the tests.</p>
</div>
<div class="paragraph">
<p>Quarkus provides a few implementations of <code>QuarkusTestResourceLifecycleManager</code> out of the box (see <code>io.quarkus.test.h2.H2DatabaseTestResource</code> which starts an H2 database, or <code>io.quarkus.test.kubernetes.client.KubernetesMockServerTestResource</code> which starts a mock Kubernetes API server), but it is common to create custom implementations to address specific application needs. Common cases include starting docker containers using <a href="https://www.testcontainers.org/">Testcontainers</a> (an example of which can be found <a href="https://github.com/quarkusio/quarkus-quickstarts/blob/main/kafka-quickstart/src/test/java/org/acme/kafka/KafkaResource.java">here</a>), or starting a mock HTTP server using <a href="http://wiremock.org/">Wiremock</a> (an example of which can be found <a href="https://github.com/geoand/quarkus-test-demo/blob/master/src/test/java/org/acme/getting/started/country/WiremockCountries.java">here</a>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="本地可执行程序测试"><a class="anchor" href="#本地可执行程序测试"></a>14. 本地可执行程序测试</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is also possible to test native executables using <code>@NativeImageTest</code>. This supports all the features mentioned in this guide except injecting into tests (and the native executable runs in a separate non-JVM process this is not really possible).</p>
</div>
<div class="paragraph">
<p>This is covered in the <a href="building-native-image">Native Executable Guide</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test-from-ide"><a class="anchor" href="#test-from-ide"></a>15. 从IDE中运行 <code>@QuarkusTest</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most IDEs offer the possibility to run a selected class as JUnit test directly. For this you should set a few properties in the settings of your chosen IDE:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.util.logging.manager</code> (see <a href="logging">Logging Guide</a>)</p>
</li>
<li>
<p><code>maven.home</code> (only if there are any custom settings in <code>${maven.home}/conf/settings.xml</code>, see <a href="maven-tooling">Maven Guide</a>)</p>
</li>
<li>
<p><code>maven.settings</code> (in case a custom version of <code>settings.xml</code> file should be used for the tests)</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="eclipse-separate-jre-definition"><a class="anchor" href="#eclipse-separate-jre-definition"></a>15.1. Eclipse separate JRE definition</h3>
<div class="paragraph">
<p>将您当前的 "已安装的JRE "定义复制为一个新的定义，在这里您会将其作为新的虚拟机参数配置来添加属性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-Djava.util.logging.manager=org.jboss.logmanager.LogManager</code></p>
</li>
<li>
<p><code>-Dmaven.home=&lt;path-to-your-maven-installation&gt;</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>使用这个JRE定义作为您的Quarkus项目的目标运行时，该运行时将被用于所有 "作为JUnit运行(Run as JUnit) "的配置。</p>
</div>
</div>
<div class="sect2">
<h3 id="vscode-run-with-配置"><a class="anchor" href="#vscode-run-with-配置"></a>15.2. VSCode "run with "配置</h3>
<div class="paragraph">
<p>The <code>settings.json</code> placed in the root of your project directory or in the workspace will need the workaround in your test configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"java.test.config": [
    {
        "name": "quarkusConfiguration",
        "vmargs": [ "-Djava.util.logging.manager=org.jboss.logmanager.LogManager -Dmaven.home=&lt;path-to-your-maven-installation&gt; ..." ],
        ...
    },
  ...
]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="intellij-junit-template"><a class="anchor" href="#intellij-junit-template"></a>15.3. IntelliJ JUnit template</h3>
<div class="paragraph">
<p>Nothing needed in IntelliJ because the IDE will pick the <code>systemPropertyVariables</code> from the surefire plugin configuration in <code>pom.xml</code>.</p>
</div>
</div>
</div>
</div>
    </div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus是开放的。这个项目的所有依赖关系在<a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a>许可或者可以在有互换性的许可下使用。<br /><br />这个网站使用 <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> 来构建，代码托管于<a href='https://pages.github.com/' target='_blank'>Github Pages</a>，完全开源。当需要改善和丰富内容的时候，我们会从 <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>网站项目</a>创建分支，然后修正并发布到网站。</p>

    
      <div class="width-1-12 project-links">
        <span>导航栏</span>
        <ul class="footer-links">
          
            <li><a href="/">主页</a></li>
          
            <li><a href="/about">关于Quarkus</a></li>
          
            <li><a href="/blog">博客</a></li>
          
            <li><a href="/insights">播客</a></li>
          
            <li><a href="/events">活动</a></li>
          
            <li><a href="/newsletter">新闻</a></li>
          
            <li><a href="/publications">发表</a></li>
          
            <li><a href="/awards">获奖</a></li>
          
            <li><a href="/security">安全</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>社交媒体</span>
        <ul class="footer-links">
          
            <li><a href="https://twitter.com/quarkusio">Twitter</a></li>
          
            <li><a href="https://www.facebook.com/quarkusio">Facebook</a></li>
          
            <li><a href="https://www.linkedin.com/company/quarkusio/">Linkedin</a></li>
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg">Youtube</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>协助</span>
        <ul class="footer-links">
          
            <li><a href="/support">支持</a></li>
          
            <li><a href="/guides">指南</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
            <li><a href="/get-started">入门</a></li>
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus">Stack Overflow</a></li>
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions">讨论</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">开发邮件列表</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
            <li><a href="https://quarkus.io/">English</a></li>
          
            <li><a href="https://es.quarkus.io/">Español</a></li>
          
            <li><a href="https://ja.quarkus.io/">日本語</a></li>
          
            <li><a href="https://cn.quarkus.io/">简体中文</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus由社区项目组成：</span>
        <ul class="footer-links">
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://code.quarkus.io/" target="_blank">更多...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/search-filter.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
</body>

</html>

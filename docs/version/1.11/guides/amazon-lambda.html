<!DOCTYPE html>
<html>





<head>
  <title>Quarkus - Amazon Lambda - 1.11</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="default-src https://dpm.demdex.net; script-src 'self' 'unsafe-eval' 'sha256-ANpuoVzuSex6VhqpYgsG25OHWVA1I+F6aGU04LoI+5s=' 'sha256-ipy9P/3rZZW06mTLAR0EnXvxSNcnfSDPLDuh3kzbB1w=' js.bizographics.com https://www.redhat.com https://static.redhat.com assets.adobedtm.com jsonip.com https://ajax.googleapis.com https://www.googletagmanager.com https://www.google-analytics.com https://use.fontawesome.com https://app.mailjet.com http://www.youtube.com http://www.googleadservices.com https://googleads.g.doubleclick.net https://dpm.demdex.net https://giscus.app; style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; img-src 'self' *; media-src 'self'; frame-src https://www.googletagmanager.com https://www.youtube.com https://embed.restream.io https://app.mailjet.com https://giscus.app; base-uri 'none'; object-src 'none'; form-action 'none'; font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/1.11/guides/amazon-lambda" />
  <meta property="og:title" content="Quarkus - Amazon Lambda - 1.11" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/amazon-lambda">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/goan.js" type="text/javascript"></script>
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
</head>

<body class="guides">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  

<div class="grid-wrapper communitysite">
  <div class="grid__item width-12-12">The <a href="https://quarkus.io">English version of quarkus.io</a> is the official project site. Translated sites are community supported on a best-effort basis.</div>
</div>


  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
  <div class="container">
    <div class="logo-wrapper">
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
    </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">关于<i class="fas fa-chevron-down">
</i></span>
        <ul class="submenu">
          <li><a href="/about" class="">QUARKUS是什么？</a></li>
          <li><a href="/container-first" class="">容器优先 </a></li>
          <li><a href="/continuum" class="">响应式</a></li>
          <li><a href="/developer-joy" class="">开发者的乐趣 </a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES 原生</a></li>
          <li><a href="/standards" class="">标准</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">学习 <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">入门</a></li>
          <li><a href="/guides" class="active" >指南</a></li>
          <li><a href="/qtips" class="">"Q" TIP视频</a></li>          
          <li><a href="/books" class="">书籍</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">社区 <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">支持</a></li>
          <li><a href="/blog" class="" >博客</a></li>
          <li><a href="/discussion" class="">讨论</a></li>
          <li><a href="/insights" class="" >播客</a></li>
          <li><a href="/events" class="">活动</a></li>
          <li><a href="/newsletter" class="">新闻</a></li>
          <li><a href="/publications" class="">发表</a></li>
          <li><a href="/awards" class="">获奖</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary
white">开始写代码</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://es.quarkus.io/">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/">日本語</a></li>
          </ul>
      </li>
    </ul>
  </div>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    



<div class="full-width-version-bg grey align-self">
  <div class="grid-wrapper">
    <div class="grid__item width-6-12">
      <p class="returnlink"><i class="fas fa-angle-left"></i><a href="/version/1.11/guides/">返回指南目录</a></p>
    </div>
    <div class="grid__item width-6-12 align-self-center text-right hide-mobile">
      <label id="guide-version-label">选择指南版本</label>
      <select id="guide-version-dropdown">
        
      
        
        
        
        
          
        <option value="main" >Main - SNAPSHOT</option>
        
        
      
        
        
        
        
          
        <option value="latest" >2.11 - Latest</option>
        
        
      
        
        
        
        
          
        <option value="2.7" >2.7</option>
        
        
      
        
        
        
        
          
        <option value="2.2" >2.2</option>
        
        
      
        
        
        
        
          
        <option value="1.11" selected>1.11</option>
        
        
      
    
      </select>
    </div>
  </div>
</div>

<div class="grid-wrapper guide">
  <div class="grid__item width-12-12 width-12-12-mobile">
    <h1 class="text-caps">Quarkus - Amazon Lambda </h1>
  </div>
  <div class="width-12-12">
    <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#先决条件">先决条件</a></li>
<li><a href="#入门指南">入门指南</a></li>
<li><a href="#安装aws位">安装AWS位</a></li>
<li><a href="#创建maven部署项目">创建Maven部署项目</a></li>
<li><a href="#choose">选择你的Lambda</a></li>
<li><a href="#部署到aws-lambda-java-runtime">部署到AWS Lambda Java Runtime</a></li>
<li><a href="#构建和部署">构建和部署</a></li>
<li><a href="#创建一个执行角色">创建一个执行角色</a></li>
<li><a href="#构建额外生成的文件">构建额外生成的文件</a></li>
<li><a href="#创建函数">创建函数</a></li>
<li><a href="#调用lambda">调用Lambda</a></li>
<li><a href="#更新lambda">更新Lambda</a></li>
<li><a href="#部署到aws-lambda-custom-native-runtime">部署到AWS Lambda Custom (native) Runtime</a></li>
<li><a href="#检查pom和gradle构建">检查POM和Gradle构建</a></li>
<li><a href="#gradle">Gradle build</a></li>
<li><a href="#integration-testing">Integration Testing</a></li>
<li><a href="#使用sam-cli进行测试">使用SAM CLI进行测试</a></li>
<li><a href="#修改-function-zip">修改 <code>function.zip</code></a></li>
<li><a href="#自定义-bootstrap-脚本">自定义 <code>bootstrap</code> 脚本</a></li>
<li><a href="#使用aws-xray和graalvm进行追踪">使用AWS XRay和GraalVM进行追踪</a></li>
<li><a href="#https">使用HTTPS或SSL/TLS</a></li>
<li><a href="#aws-sdk-v2">使用AWS Java SDK v2</a></li>
<li><a href="#对客户端ssl的额外要求">对客户端SSL的额外要求</a></li>
<li><a href="#亚马逊alexa整合">亚马逊Alexa整合</a></li>
</ul></div>
    <div>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><code>quarkus-amazon-lambda</code> 扩展允许你使用Quarkus来构建你的AWS Lambdas。你的Lambdas可以根据需要使用来自CDI或Spring的注入注解，以及其他Quarkus设施。</p>
</div>
<div class="paragraph">
<p>Quarkus lambdas可以使用Amazon Java Runtime进行部署，如果你想要更小的内存占用和更快的冷启动启动时间，你也可以构建一个本地可执行文件，并使用Amazon的Custom Runtime。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>这项技术被认为是preview。</p>
</div>
<div class="paragraph">
<p>In <em>preview</em>, backward compatibility and presence in the ecosystem is not guaranteed. Specific improvements might require to change configuration or APIs and plans to become <em>stable</em> are under way. Feedback is welcome on our <a href="https://groups.google.com/d/forum/quarkus-dev">mailing list</a> or as issues in our <a href="https://github.com/quarkusio/quarkus/issues">GitHub issue tracker</a>.</p>
</div>
<div class="paragraph">
<p>For a full list of possible extension statuses, check our <a href="https://quarkus.io/faq/#extension-status">FAQ entry</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="先决条件"><a class="anchor" href="#先决条件"></a>先决条件</h2>
<div class="sectionbody">
<div class="paragraph">
<p>要完成这个指南，你需要：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>less than 30 minutes</p>
</li>
<li>
<p>JDK 11 (AWS requires JDK 1.8 or 11)</p>
</li>
<li>
<p>Apache Maven 3.6.2+</p>
</li>
<li>
<p><a href="https://aws.amazon.com">An Amazon AWS account</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html">AWS CLI</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html">AWS SAM CLI</a> ，用于本地测试</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For Gradle projects please <a href="#gradle">see below</a>, or for further reference consult the guide in the <a href="gradle-tooling">Gradle setup page</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="入门指南"><a class="anchor" href="#入门指南"></a>入门指南</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本指南将指导你通过一个maven原型生成一个Java项目的例子，并将其部署到AWS。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="安装aws位"><a class="anchor" href="#安装aws位"></a>安装AWS位</h2>
<div class="sectionbody">
<div class="paragraph">
<p>安装所有AWS位可能是本指南中最困难的事情。请确保你遵循安装AWS CLI的所有步骤。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="创建maven部署项目"><a class="anchor" href="#创建maven部署项目"></a>创建Maven部署项目</h2>
<div class="sectionbody">
<div class="paragraph">
<p>使用我们的Maven Archetype创建Quarkus AWS Lambda maven项目。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn archetype:generate \
       -DarchetypeGroupId=io.quarkus \
       -DarchetypeArtifactId=quarkus-amazon-lambda-archetype \
       -DarchetypeVersion=1.11.7.Final</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果你喜欢使用Gradle，你可以通过 <a href="https://code.quarkus.io/">code.quarkus.io</a> 将 <code>quarkus-amazon-lambda</code> 扩展添加为依赖项，来快速而轻松地生成一个Gradle项目。</p>
</div>
<div class="paragraph">
<p>将build.gradle、gradle.properties和settings.gradle复制到上述生成的Maven archetype项目中，以按照本指南进行操作。</p>
</div>
<div class="paragraph">
<p>执行：gradle wrapper来设置gradle wrapper（推荐）。</p>
</div>
<div class="paragraph">
<p>The dependency for <code>quarkus-test-amazon-lambda</code> will also need to be added to your build.gradle.</p>
</div>
<div class="paragraph">
<p>关于Gradle的全部细节，<a href="#gradle">请见下文</a> 。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="choose"><a class="anchor" href="#choose"></a>选择你的Lambda</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>quarkus-amazon-lambda</code> 扩展会为直接实现亚马逊 <code>RequestHandler&lt;?, ?&gt;</code> 或 <code>RequestStreamHandler</code> 接口的类扫描你的项目。它必须在你的项目中找到一个实现该接口的类，否则它将抛出一个构建时间失败。如果它发现一个以上的处理程序类，也会抛出一个构建时间异常。</p>
</div>
<div class="paragraph">
<p>但有时，你可能会有几个共享代码的相关lambdas，创建多个maven模块是你不想做的开销。 <code>quarkus-amazon-lambda</code> 扩展允许你在一个项目中捆绑多个lambdas，并使用配置或环境变量来选择你要部署的处理程序。</p>
</div>
<div class="paragraph">
<p>生成的项目里有三个lambdas。两个实现 <code>RequestHandler&lt;?, ?&gt;</code> 接口，一个实现 <code>RequestStreamHandler</code> 接口。使用了一个，另两个未使用。如果你打开 <code>src/main/resources/application.properties</code> ，你会看到：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.lambda.handler=test</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>quarkus.lambda.handler</code> 属性告诉Quarkus要部署哪个lambda处理程序。这也可以用一个环境变量来覆盖。</p>
</div>
<div class="paragraph">
<p>如果你查看项目中生成的三个处理程序类，你会发现它们的 <code>@Named</code> 不同。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named("test")
public class TestLambda implements RequestHandler&lt;InputObject, OutputObject&gt; {
}

@Named("unused")
public class UnusedLambda implements RequestHandler&lt;InputObject, OutputObject&gt; {
}

@Named("stream")
public class StreamLambda implements RequestStreamHandler {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>处理程序类的CDI名称必须与 <code>quarkus.lambda.handler</code> 属性中指定的值匹配。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="部署到aws-lambda-java-runtime"><a class="anchor" href="#部署到aws-lambda-java-runtime"></a>部署到AWS Lambda Java Runtime</h2>
<div class="sectionbody">
<div class="paragraph">
<p>有几个步骤可以让lambda在AWS上运行。生成的maven项目包含一个有用的脚本，来为纯Java和原生部署创建、更新、删除和调用你的lambda。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="构建和部署"><a class="anchor" href="#构建和部署"></a>构建和部署</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Build the project using maven.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw clean package</code></pre>
</div>
</div>
<div class="paragraph">
<p>or, if using Gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./gradlew clean assemble</pre>
</div>
</div>
<div class="paragraph">
<p>这将对你的代码进行编译和打包。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="创建一个执行角色"><a class="anchor" href="#创建一个执行角色"></a>创建一个执行角色</h2>
<div class="sectionbody">
<div class="paragraph">
<p>查看使用AWS CLI部署lambda的 <a href="https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-awscli.html">入门指南</a> 。具体来说，确保你已经创建了一个 <code>Execution Role</code> 。你需要在你的配置文件或控制台窗口中定义一个 <code>LAMBDA_ROLE_ARN</code> 环境变量，或者，你可以编辑由构建生成的 <code>manage.sh</code> 脚本，并把角色值直接放在那里：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">LAMBDA_ROLE_ARN="arn:aws:iam::1234567890:role/lambda-role"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="构建额外生成的文件"><a class="anchor" href="#构建额外生成的文件"></a>构建额外生成的文件</h2>
<div class="sectionbody">
<div class="paragraph">
<p>运行构建后，有几个由 <code>quarkus-amazon-lambda</code> 扩展额外生成的文件。对于maven，这些文件位于构建目录：<code>target/</code> 中，对于gradle，则位于 <code>build/</code> 中。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>function.zip</code> - lambda deployment file</p>
</li>
<li>
<p><code>manage.sh</code> - wrapper around aws lambda cli calls</p>
</li>
<li>
<p><code>bootstrap-example.sh</code> - 用于原生部署的bootstrap脚本示例</p>
</li>
<li>
<p><code>sam.jvm.yaml</code> - (可选)用于sam cli和本地测试</p>
</li>
<li>
<p><code>sam.native.yaml</code> - (可选)，用于Sam cli和原生本地测试</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="创建函数"><a class="anchor" href="#创建函数"></a>创建函数</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>target/manage.sh</code> 脚本是用于使用AWS Lambda Java runtime管理你的lambda。此脚本只是为了方便你而提供。如果你想了解执行哪些aws命令来创建、删除和更新你的lambdas，请检查 <code>manage.sh</code> 脚本的输出。</p>
</div>
<div class="paragraph">
<p><code>manage.sh</code> 支持四种操作： <code>create</code>， <code>delete</code>， <code>update</code> 和 <code>invoke</code> 。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
为了验证你的设置，是否安装了AWS CLI，是否为AWS访问密钥执行了aws configure，是否设置了 <code>LAMBDA_ROLE_ARN</code> 环境变量（如上所述），请执行不带任何参数的 <code>manage.sh</code> 。将会打印出一个使用说明，来对你进行相应的指导。
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果使用Gradle， <code>manage.sh</code> 中二进制文件的路径必须从 <code>target</code> 变为 <code>build</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>要查看 <code>用法</code> 声明，并验证AWS配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>你可以使用以下命令 <code>创建</code> 你的函数：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh create</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者如果在这个shell中没有定义 <code>LAMBDA_ROLE_ARN</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">LAMBDA_ROLE_ARN="arn:aws:iam::1234567890:role/lambda-role" sh target/manage.sh create</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
不要改变处理程序的开关。这必须被硬编码为 <code>io.quarkus.amazon.lambda.runtime.QuarkusStreamHandler::handleRequest</code> 。这个处理程序引导Quarkus，并包装你实际的处理程序，以便可以执行注入。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>如果在创建函数时有任何问题，你必须在重新运行 <code>create</code> 命令之前使用 <code>delete</code> 函数来删除它。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh delete</code></pre>
</div>
</div>
<div class="paragraph">
<p>命令也可以是叠加的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh delete create</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="调用lambda"><a class="anchor" href="#调用lambda"></a>调用Lambda</h2>
<div class="sectionbody">
<div class="paragraph">
<p>使用 <code>invoke</code> 命令来调用你的函数。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh invoke</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个lambda示例接受通过 <code>--payload</code> 开关传入的输入，该开关指向项目根目录中的一个json文件。</p>
</div>
<div class="paragraph">
<p>这个lambda也可以使用SAM CLI在本地调用，如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sam local invoke --template target/sam.jvm.yaml --event payload.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果你正在使用原生镜像构建，只需将模板名称替换为原生版本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sam local invoke --template target/sam.native.yaml --event payload.json</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="更新lambda"><a class="anchor" href="#更新lambda"></a>更新Lambda</h2>
<div class="sectionbody">
<div class="paragraph">
<p>你可以在你认为合适的时候更新Java代码。一旦你重建了，你可以通过执行 <code>update</code> 命令来重新部署你的lambda。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh update</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="部署到aws-lambda-custom-native-runtime"><a class="anchor" href="#部署到aws-lambda-custom-native-runtime"></a>部署到AWS Lambda Custom (native) Runtime</h2>
<div class="sectionbody">
<div class="paragraph">
<p>如果你想让你的lambda有更低的内存占用和更快的初始化时间，你可以把你的Java代码编译成本地可执行文件。只是确保要用 <code>-Pnative</code> 开关重建你的项目。</p>
</div>
<div class="paragraph">
<p>For Linux hosts execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn package -Pnative</code></pre>
</div>
</div>
<div class="paragraph">
<p>or, if using Gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew build -Dquarkus.package.type=native</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are building on a non-Linux system, you will need to also pass in a property instructing quarkus to use a docker build as Amazon Lambda requires linux binaries. You can do this by passing this property to your Maven build: <code>-Dnative-image.docker-build=true</code>, or for Gradle: <code>--docker-build=true</code>. This requires you to have docker installed locally, however.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw clean install -Pnative -Dnative-image.docker-build=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>or, if using Gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew build -Dquarkus.package.type=native -Dquarkus.native.container-build=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>这两个命令中的任何一个都会编译并创建一个本地可执行镜像。它还会生成一个zip文件 <code>target/function.zip</code> 。这个zip文件包含已重命名为 <code>bootstrap</code> 的本地可执行镜像，。这是AWS Lambda Custom (Provided) Runtime的要求。</p>
</div>
<div class="paragraph">
<p>这里的说明与上面的完全一样，但有一个变化：你需要将 <code>native</code> 作为第一个参数添加到 <code>manage.sh</code> 脚本中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh native create</code></pre>
</div>
</div>
<div class="paragraph">
<p>如上所述，命令可以叠加。如果你想使用原生镜像构建，唯一的要求是 <code>native</code> 是第一个参数。该脚本将处理管理你原生镜像功能部署所需的其余细节。</p>
</div>
<div class="paragraph">
<p>如果你想了解执行了哪些aws命令来创建、删除和更新lambdas，请检查 <code>manage.sh</code> 脚本的输出。</p>
</div>
<div class="paragraph">
<p>对于原生的创建命令，需要注意的一点是， <code>aws lambda create-function</code> 调用必须设置一个特定的环境变量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">--environment 'Variables={DISABLE_SIGNAL_HANDLERS=true}'</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="检查pom和gradle构建"><a class="anchor" href="#检查pom和gradle构建"></a>检查POM和Gradle构建</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is nothing special about the POM other than the inclusion of the <code>quarkus-amazon-lambda</code> and <code>quarkus-test-amazon-lambda</code> extensions as a dependencies. The extension automatically generates everything you might need for your lambda deployment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
在这个扩展的前几个版本中，你必须设置你的pom或gradle来为原生部署压缩你的可执行文件，但现在不再是这样了。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gradle"><a class="anchor" href="#gradle"></a>Gradle build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Similarly for Gradle projects, you also just have to add the <code>quarkus-amazon-lambda</code> and <code>quarkus-test-amazon-lambda</code> dependencies. The extension automatically generates everything you might need for your lambda deployment.</p>
</div>
<div class="paragraph">
<p>Gradle依赖项示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
    implementation enforcedPlatform("${quarkusPlatformGroupId}:${quarkusPlatformArtifactId}:${quarkusPlatformVersion}")
    implementation 'io.quarkus:quarkus-resteasy'
    implementation 'io.quarkus:quarkus-amazon-lambda'

    testimplementation  "io.quarkus:quarkus-test-amazon-lambda"

    testImplementation 'io.quarkus:quarkus-junit5'
    testImplementation 'io.rest-assured:rest-assured'
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="integration-testing"><a class="anchor" href="#integration-testing"></a>Integration Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Quarkus Amazon Lambda extension has a matching test framework that provides functionality to execute standard JUnit tests on your AWS Lambda function, via the integration layer that Quarkus provides. This is true for both JVM and native modes. It provides similar functionality to the SAM CLI, without the overhead of Docker.</p>
</div>
<div class="paragraph">
<p>To illustrate, the project generated by the Maven archetype, generates a JUnit test for the <code>RequestHandler&lt;?, ?&gt;</code> implementation, which is shown below. The test replicates the execution environment, for the function that is selected for invocation, as described <a href="#choose">above</a>.</p>
</div>
<div class="paragraph">
<p>To use the integration tests in your project there is a required property, in <code>src/test/resources/application.properties</code>. If not included, the integration tests will be in a constant loop.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.lambda.enable-polling-jvm-mode=true</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are following along with the example Maven archetype project for AWS Lambda in this guide, it includes the required property <code>quarkus.lambda.enable-polling-jvm-mode=true</code> in the test <code>application.properties</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@QuarkusTest
public class LambdaHandlerTest {

    @Test
    public void testSimpleLambdaSuccess() throws Exception {
        InputObject in = new InputObject();
        in.setGreeting("Hello");
        in.setName("Stu");

        OutputObject out = LambdaClient.invoke(OutputObject.class, in);

        Assertions.assertEquals("Hello Stu", out.getResult());
        Assertions.assertTrue(out.getRequestId().matches("aws-request-\\d"), "Expected requestId as 'aws-request-&lt;number&gt;'");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, if you are using a <code>RequestStreamHandler</code> implementation, you can add a matching JUnit test, like below, which aligns to the generated <code>StreamLambda</code> class in the generated project.</p>
</div>
<div class="paragraph">
<p>Obviously, these two types of tests are mutually exclusive. You must have a test that corresponds to the implemented AWS Lambda interfaces, whether <code>RequestHandler&lt;?, ?&gt;</code> or <code>RequestStreamHandler</code>.</p>
</div>
<div class="paragraph">
<p>Two versions of the Test for <code>RequestStreamHandler</code> are presented below. You can use either, depending on the needs of your Unit test. The first is obviously simpler and quicker. Using Java streams can require more coding.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@QuarkusTest
public class LambdaStreamHandlerTest {

    private static Logger LOG = Logger.getLogger(LambdaStreamHandlerTest.class);

    @Test
    public void testSimpleLambdaSuccess() throws Exception {
        String out = LambdaClient.invoke(String.class, "lowercase");
        Assertions.assertEquals("LOWERCASE", out);
    }

    @Test
    public void testInputStreamSuccess() {
        try {
            String input = "{ \"name\": \"Bill\", \"greeting\": \"hello\"}";
            InputStream inputStream = new ByteArrayInputStream(input.getBytes());
            ByteArrayOutputStream outputStream = new ByteArrayOutputStream();

            LambdaClient.invoke(inputStream, outputStream);

            ByteArrayInputStream out = new ByteArrayInputStream(outputStream.toByteArray());
            StringBuilder response = new StringBuilder();
            int i = 0;
            while ((i = out.read()) != -1) {
                response.append((char)i);
            }

            Assertions.assertTrue(response.toString().contains("BILL"));
        } catch (Exception e) {
            Assertions.fail(e.getMessage());
        }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your code uses CDI injection, this too will be executed, along with mocking functionality, see the <a href="getting-started-testing">Test Guide</a> for more details.</p>
</div>
<div class="paragraph">
<p>To add JUnit functionality for native tests, add the <code>@NativeImageTest</code> annotation to a subclass of your test class, which will execute against your native image, and can be leveraged in an IDE.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="使用sam-cli进行测试"><a class="anchor" href="#使用sam-cli进行测试"></a>使用SAM CLI进行测试</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html">AWS SAM CLI</a> 允许你在模拟的Lambda环境中在你的笔记本电脑上本地运行lambdas。这需要安装 <a href="https://www.docker.com/products/docker-desktop">docker</a> 。如果你选择使用它，这是一个可选的方法。否则，Quarkus的JUnit集成应该足以满足你的大部分需求。</p>
</div>
<div class="paragraph">
<p>已经为JVM和原生执行模式生成了一个启动模板。</p>
</div>
<div class="paragraph">
<p>运行下面的SAM CLI命令来本地测试你的lambda函数，传递合适的SAM <code>模板</code> 。 <code>event</code> 参数使用任何JSON文件，在本例中是样本 <code>payload.json</code> 。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果使用Gradle，YAML模板中的二进制文件的路径必须从 <code>target</code> 改为 <code>build</code>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sam local invoke --template target/sam.jvm.yaml --event payload.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>本地镜像也可以使用 <code>sam.native.yaml</code> 模板进行本地测试：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sam local invoke --template target/sam.native.yaml --event payload.json</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="修改-function-zip"><a class="anchor" href="#修改-function-zip"></a>修改 <code>function.zip</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The are times where you may have to add some additions to the <code>function.zip</code> lambda deployment that is generated by the build. To do this create a <code>zip.jvm</code> or <code>zip.native</code> directory within <code>src/main</code>. Create <code>zip.jvm/</code> if you are doing a pure Java lambda. <code>zip.native/</code> if you are doing a native deployment.</p>
</div>
<div class="paragraph">
<p>你在zip目录下创建的任何文件和目录都将包括在 <code>function.zip</code> 内</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="自定义-bootstrap-脚本"><a class="anchor" href="#自定义-bootstrap-脚本"></a>自定义 <code>bootstrap</code> 脚本</h2>
<div class="sectionbody">
<div class="paragraph">
<p>有些时候你可能想在lambda调用你的原生quarkus lambda部署时设置特定的系统属性或其他参数。如果你在 <code>zip.native</code> 中包含一个 <code>bootstrap</code> 脚本文件，quarkus 扩展会在 <code>function.zip</code> 中自动将可执行文件重命名为 <code>runner</code> ，并将 <code>bootstrap</code> 脚本的 unix 模式设置为可执行。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果你包含一个自定义的 <code>bootstrap</code> 脚本，那么本地可执行文件必须被引用为 <code>runner</code> 。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>扩展会在 <code>target/bootstrap-example.sh</code> 中生成了一个示例脚本。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="使用aws-xray和graalvm进行追踪"><a class="anchor" href="#使用aws-xray和graalvm进行追踪"></a>使用AWS XRay和GraalVM进行追踪</h2>
<div class="sectionbody">
<div class="paragraph">
<p>如果你正在构建原生镜像，并希望在你的lambda中使用 <a href="https://aws.amazon.com/xray">AWS X-Ray Tracing</a> ，那么你将需要在你的pom中包含 <code>quarkus-amazon-lambda-xray</code> 来作为一个依赖项。AWS X-Ray库与GraalVM并不完全兼容，因此我们不得不做一些整合工作来使其正常运行。</p>
</div>
<div class="paragraph">
<p>此外，记得在 <code>manage.sh</code> ， <code>cmd_create()</code> 函数中启用AWS X-Ray追踪参数。这也可以在AWS管理控制台中进行设置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">    --tracing-config Mode=Active</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于Sam模板文件，将以下内容添加到YAML函数属性中。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">    Tracing: Active</code></pre>
</div>
</div>
<div class="paragraph">
<p>AWS X-Ray确实在你的发行版中添加了许多类，确保你至少使用了256MB的AWS Lambda内存大小。这在 <code>manage.sh</code> <code>cmd_create()</code> 中进行了明确的设置。虽然原生镜像可能总是使用较低的内存设置，但建议保持设置不变，特别是为了帮助比较性能。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="https"><a class="anchor" href="#https"></a>使用HTTPS或SSL/TLS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If your code makes HTTPS calls, such as to a micro-service (or AWS service), you will need to add configuration to the native image, as GraalVM will only include the dependencies when explicitly declared. Quarkus, by default enables this functionality on extensions that implicitly require it. For further information, please consult the <a href="native-and-ssl">Quarkus SSL guide</a></p>
</div>
<div class="paragraph">
<p>打开src/main/resources/application.properties，并在你的原生镜像中添加以下行来启用SSL。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.ssl.native=true</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="aws-sdk-v2"><a class="anchor" href="#aws-sdk-v2"></a>使用AWS Java SDK v2</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Quarkus now has extensions for DynamoDB, S3, SNS and SQS (more coming). Please check those guides on how to use the various AWS Services with Quarkus, as opposed to wiring manually like below.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>通过最小的整合，可以利用AWS Java SDK v2，其可以用来调用诸如SQS、SNS、S3和DynamoDB等服务。</p>
</div>
<div class="paragraph">
<p>然而，对于原生镜像，由于GraalVM编译中的问题（目前），在使用同步模式时，URL Connection客户端必须优先于Apache HTTP客户端。</p>
</div>
<div class="paragraph">
<p>把 <code>quarkus-jaxb</code> 作为一个依赖项添加到你的Maven <code>pom.xml</code> ，或Gradle <code>build.gradle</code> 文件中。</p>
</div>
<div class="paragraph">
<p>你还必须强制你的SQS、SNS、S3等AWS服务客户端使用URL Connection客户端，其通过HTTPS连接到AWS服务，因此包含启用了SSL的属性，如上面 <a href="#https">[https</a>] 部分中所述。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// select the appropriate client, in this case SQS, and
// insert your region, instead of XXXX, which also improves startup time over the default client
  client = SqsClient.builder().region(Region.XXXX).httpClient(software.amazon.awssdk.http.urlconnection.UrlConnectionHttpClient.builder().build()).build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于Maven，在你的 <code>pom.xml</code> 中添加以下内容。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;properties&gt;
        &lt;aws.sdk2.version&gt;2.10.69&lt;/aws.sdk2.version&gt;
    &lt;/properties&gt;

    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;

            &lt;dependency&gt;
                &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt;
                &lt;artifactId&gt;bom&lt;/artifactId&gt;
                &lt;version&gt;${aws.sdk2.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;

        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;
    &lt;dependencies&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt;
            &lt;artifactId&gt;url-connection-client&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt;
            &lt;artifactId&gt;apache-client&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;commons-logging&lt;/groupId&gt;
                    &lt;artifactId&gt;commons-logging&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt;
            &lt;!-- sqs/sns/s3 etc --&gt;
            &lt;artifactId&gt;sqs&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;!-- exclude the apache-client and netty client --&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt;
                    &lt;artifactId&gt;apache-client&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt;
                    &lt;artifactId&gt;netty-nio-client&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;commons-logging&lt;/groupId&gt;
                    &lt;artifactId&gt;commons-logging&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.jboss.logging&lt;/groupId&gt;
            &lt;artifactId&gt;commons-logging-jboss-logging&lt;/artifactId&gt;
            &lt;version&gt;1.0.0.Final&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
if you see <code>java.security.InvalidAlgorithmParameterException: the trustAnchors parameter must be non-empty</code> or similar SSL error, due to the current status of GraalVM, there is some additional work to bundle the <code>function.zip</code>, as below. For more information, please see the <a href="native-and-ssl">Quarkus Native SSL Guide</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="对客户端ssl的额外要求"><a class="anchor" href="#对客户端ssl的额外要求"></a>对客户端SSL的额外要求</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The native executable requires some additional steps to enable client ssl that S3 and other aws libraries need.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>一个自定义的 <code>bootstrap</code> 脚本</p>
</li>
<li>
<p>必须将 <code>libsunec.so</code> 添加到 <code>function.zip</code> 中</p>
</li>
<li>
<p>必须将 <code>cacerts</code> 添加到 <code>function.zip</code> 中</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>要做到这一点，首先使用你的构建创建一个目录 <code>src/main/zip.native/</code> 。接下来在 <code>src/main/zip.native/</code> 中创建一个名为 <code>bootstrap</code> 的shell脚本文件，如下所示。例如，在你的构建文件夹（target或 build）中自动创建一个名为 <code>bootstrap-example.sh</code> 的文件</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/usr/bin/env bash

./runner -Djava.library.path=./ -Djavax.net.ssl.trustStore=./cacerts</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果你的 <code>cacerts</code> 文件有密码保护，则额外设置 <code>-Djavax.net.ssl.trustStorePassword=changeit</code> 。</p>
</div>
<div class="paragraph">
<p>接下来，你必须将GraalVM发行版中的一些文件复制到 <code>src/main/zip.native/</code> 。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
对于这些文件，GraalVM版本可能有不同的路径，不论你使用的是Java 8还是11版本。请做相应的调整。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp $GRAALVM_HOME/lib/libsunec.so $PROJECT_DIR/src/main/zip.native/
cp $GRAALVM_HOME/lib/security/cacerts $PROJECT_DIR/src/main/zip.native/</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在，当你运行原生构建时，所有这些文件都将包含在 <code>function.zip</code> 中</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果你使用Docker镜像来进行构建，那么你必须从这个镜像中提取这些文件。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>要提取所需的ssl，你必须在后台启动一个Docker容器，并附加到该容器来复制工件。</p>
</div>
<div class="paragraph">
<p>首先，让我们启动GraalVM容器，注意容器ID的输出。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run -it -d --entrypoint bash quay.io/quarkus/ubi-quarkus-native-image:20.3.1-java11

# This will output a container id, like 6304eea6179522aff69acb38eca90bedfd4b970a5475aa37ccda3585bc2abdde
# Note this value as we will need it for the commands below</code></pre>
</div>
</div>
<div class="paragraph">
<p>首先是libsunec.so，用于SSL实现的C库：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker cp {container-id-from-above}:/opt/graalvm/lib/libsunec.so src/main/zip.native/</code></pre>
</div>
</div>
<div class="paragraph">
<p>第二是cacerts，证书库。你可能还需要定期获取更新的副本。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker cp {container-id-from-above}:/opt/graalvm/lib/security/cacerts src/main/zip.native/</code></pre>
</div>
</div>
<div class="paragraph">
<p>你的最终档案将看起来像这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">jar tvf target/function.zip

    bootstrap
    runner
    cacerts
    libsunec.so</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="亚马逊alexa整合"><a class="anchor" href="#亚马逊alexa整合"></a>亚马逊Alexa整合</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To use Alexa with Quarkus native, please add the following extension.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">        &lt;dependency&gt;
            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
            &lt;artifactId&gt;quarkus-amazon-alexa&lt;/artifactId&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create your Alexa handler, as normal, by sub-classing the abstract <code>com.amazon.ask.SkillStreamHandler</code>, and add your request handler implementation.</p>
</div>
<div class="paragraph">
<p>That&#8217;s all there is to it!</p>
</div>
</div>
</div>
    </div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus是开放的。这个项目的所有依赖关系在<a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a>许可或者可以在有互换性的许可下使用。<br /><br />这个网站使用 <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> 来构建，代码托管于<a href='https://pages.github.com/' target='_blank'>Github Pages</a>，完全开源。当需要改善和丰富内容的时候，我们会从 <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>网站项目</a>创建分支，然后修正并发布到网站。</p>

    
      <div class="width-1-12 project-links">
        <span>导航栏</span>
        <ul class="footer-links">
          
            <li><a href="/">主页</a></li>
          
            <li><a href="/about">关于Quarkus</a></li>
          
            <li><a href="/blog">博客</a></li>
          
            <li><a href="/insights">播客</a></li>
          
            <li><a href="/events">活动</a></li>
          
            <li><a href="/newsletter">新闻</a></li>
          
            <li><a href="/publications">发表</a></li>
          
            <li><a href="/awards">获奖</a></li>
          
            <li><a href="/security">安全</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>社交媒体</span>
        <ul class="footer-links">
          
            <li><a href="https://twitter.com/quarkusio">Twitter</a></li>
          
            <li><a href="https://www.facebook.com/quarkusio">Facebook</a></li>
          
            <li><a href="https://www.linkedin.com/company/quarkusio/">Linkedin</a></li>
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg">Youtube</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>协助</span>
        <ul class="footer-links">
          
            <li><a href="/support">支持</a></li>
          
            <li><a href="/guides">指南</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
            <li><a href="/get-started">入门</a></li>
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus">Stack Overflow</a></li>
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions">讨论</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">开发邮件列表</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
            <li><a href="https://quarkus.io/">English</a></li>
          
            <li><a href="https://es.quarkus.io/">Español</a></li>
          
            <li><a href="https://ja.quarkus.io/">日本語</a></li>
          
            <li><a href="https://cn.quarkus.io/">简体中文</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus由社区项目组成：</span>
        <ul class="footer-links">
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://code.quarkus.io/" target="_blank">更多...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/search-filter.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
</body>

</html>

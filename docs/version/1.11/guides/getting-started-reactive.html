<!DOCTYPE html>
<html>





<head>
  <title>Quarkus - 响应式入门 - 1.11</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="default-src https://dpm.demdex.net; script-src 'self' 'unsafe-eval' 'sha256-ANpuoVzuSex6VhqpYgsG25OHWVA1I+F6aGU04LoI+5s=' 'sha256-ipy9P/3rZZW06mTLAR0EnXvxSNcnfSDPLDuh3kzbB1w=' js.bizographics.com https://www.redhat.com https://static.redhat.com assets.adobedtm.com jsonip.com https://ajax.googleapis.com https://www.googletagmanager.com https://www.google-analytics.com https://use.fontawesome.com https://app.mailjet.com http://www.youtube.com http://www.googleadservices.com https://googleads.g.doubleclick.net https://dpm.demdex.net https://giscus.app; style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; img-src 'self' *; media-src 'self'; frame-src https://www.googletagmanager.com https://www.youtube.com https://embed.restream.io https://app.mailjet.com https://giscus.app; base-uri 'none'; object-src 'none'; form-action 'none'; font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/1.11/guides/getting-started-reactive" />
  <meta property="og:title" content="Quarkus - 响应式入门 - 1.11" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/getting-started-reactive">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/goan.js" type="text/javascript"></script>
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
</head>

<body class="guides">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  

<div class="grid-wrapper communitysite">
  <div class="grid__item width-12-12">The <a href="https://quarkus.io">English version of quarkus.io</a> is the official project site. Translated sites are community supported on a best-effort basis.</div>
</div>


  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
  <div class="container">
    <div class="logo-wrapper">
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
    </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">关于<i class="fas fa-chevron-down">
</i></span>
        <ul class="submenu">
          <li><a href="/about" class="">QUARKUS是什么？</a></li>
          <li><a href="/container-first" class="">容器优先 </a></li>
          <li><a href="/continuum" class="">响应式</a></li>
          <li><a href="/developer-joy" class="">开发者的乐趣 </a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES 原生</a></li>
          <li><a href="/standards" class="">标准</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">学习 <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">入门</a></li>
          <li><a href="/guides" class="active" >指南</a></li>
          <li><a href="/qtips" class="">"Q" TIP视频</a></li>          
          <li><a href="/books" class="">书籍</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">社区 <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">支持</a></li>
          <li><a href="/blog" class="" >博客</a></li>
          <li><a href="/discussion" class="">讨论</a></li>
          <li><a href="/insights" class="" >播客</a></li>
          <li><a href="/events" class="">活动</a></li>
          <li><a href="/newsletter" class="">新闻</a></li>
          <li><a href="/publications" class="">发表</a></li>
          <li><a href="/awards" class="">获奖</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary
white">开始写代码</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://es.quarkus.io/">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/">日本語</a></li>
          </ul>
      </li>
    </ul>
  </div>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    



<div class="full-width-version-bg grey align-self">
  <div class="grid-wrapper">
    <div class="grid__item width-6-12">
      <p class="returnlink"><i class="fas fa-angle-left"></i><a href="/version/1.11/guides/">返回指南目录</a></p>
    </div>
    <div class="grid__item width-6-12 align-self-center text-right hide-mobile">
      <label id="guide-version-label">选择指南版本</label>
      <select id="guide-version-dropdown">
        
      
        
        
        
        
          
        <option value="main" >Main - SNAPSHOT</option>
        
        
      
        
        
        
        
          
        <option value="latest" >2.11 - Latest</option>
        
        
      
        
        
        
        
          
        <option value="2.7" >2.7</option>
        
        
      
        
        
        
        
          
        <option value="2.2" >2.2</option>
        
        
      
        
        
        
        
          
        <option value="1.11" selected>1.11</option>
        
        
      
    
      </select>
    </div>
  </div>
</div>

<div class="grid-wrapper guide">
  <div class="grid__item width-12-12 width-12-12-mobile">
    <h1 class="text-caps">Quarkus - 响应式入门 </h1>
  </div>
  <div class="width-12-12">
    <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#先决条件">先决条件</a></li>
<li><a href="#解决方案">解决方案</a></li>
<li><a href="#quarkus的多响应式方面特征">Quarkus的多响应式方面特征</a></li>
<li><a href="#mutiny">Mutiny - 一个响应式编程库</a></li>
<li><a href="#创建项目">创建项目</a>
<ul class="sectlevel2">
<li><a href="#响应式-jax-rs-资源">响应式 JAX-RS 资源</a></li>
</ul>
</li>
<li><a href="#处理流">处理流</a></li>
<li><a href="#使用响应式-api">使用响应式 API</a>
<ul class="sectlevel2">
<li><a href="#使用quarkus响应式api">使用Quarkus响应式API</a></li>
<li><a href="#使用-vert-x-客户端">使用 Vert.x 客户端</a></li>
<li><a href="#使用-rxjava-或-reactor-api">使用 RxJava 或 Reactor API</a></li>
<li><a href="#使用completionstages或publisher-api">使用CompletionStages或Publisher API</a></li>
</ul>
</li>
<li><a href="#下一步做什么">下一步做什么？</a></li>
</ul></div>
    <div>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>了解如何使用Quarkus创建响应式应用程序，并探索Quarkus提供的不同响应式功能。 本指南涵盖：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>快速浏览一下Quarkus引擎和它如何实现响应式</p>
</li>
<li>
<p>Mutiny的简要介绍 - Quarkus使用的响应式编程库</p>
</li>
<li>
<p>RESTEasy、RESTEasy Reactive 和 Reactive Routes 之间的区别</p>
</li>
<li>
<p>使用 RESTEasy Reactive 的响应式应用程序的引导</p>
</li>
<li>
<p>创建响应式 JAX-RS 端点（异步、流等）</p>
</li>
<li>
<p>使用响应式数据库访问</p>
</li>
<li>
<p>与其他响应式API交互</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="先决条件"><a class="anchor" href="#先决条件"></a>先决条件</h2>
<div class="sectionbody">
<div class="paragraph">
<p>要完成这个指南，你需要：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>不到15分钟</p>
</li>
<li>
<p>一个IDE</p>
</li>
<li>
<p>JDK 8 或 11+安装并适当配置了 <code>JAVA_HOME</code></p>
</li>
<li>
<p>Apache Maven 3.6.2+</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="解决方案"><a class="anchor" href="#解决方案"></a>解决方案</h2>
<div class="sectionbody">
<div class="paragraph">
<p>我们建议您按照从 <a href="#bootstrapping-the-project">Bootstrapping project</a> 开始的指示，一步一步地创建应用程序。</p>
</div>
<div class="paragraph">
<p>不过，您也可以直接进入完成的例子。</p>
</div>
<div class="paragraph">
<p>下载一个 <a href="https://github.com/quarkusio/quarkus-quickstarts/archive/main.zip">存档</a>或克隆git仓库：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git clone https://github.com/quarkusio/quarkus-quickstarts.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>解决方案位于 <code>getting-started-reactive</code> 和 <code>getting-started-reactive-crud</code> 目录中。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quarkus的多响应式方面特征"><a class="anchor" href="#quarkus的多响应式方面特征"></a>Quarkus的多响应式方面特征</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus是响应式的。如果您仔细观察，就会发现一个为Quarkus应用程序提供动力的响应式引擎。这个引擎就是Eclipse Vert.x (<a href="https://vertx.io)。所有网络I/O都通过非阻塞和响应性的" class="bare">https://vertx.io)。所有网络I/O都通过非阻塞和响应性的</a> Vert.x 引擎。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/quarkus-reactive-stack.png" alt="Quarkus is based on a reactive engine" width="70%"></span></p>
</div>
<div class="paragraph">
<p>让我们举两个例子来解释它是如何工作的。想象一个传入的HTTP请求。嵌入在Quarkus中的 (Vert.x) HTTP服务器接收请求，然后将其路由到应用程序。如果请求的目标是一个 <em>imperative</em> 方法（传统的JAX-RS，代码注释为 <code>@Blocking</code>…），路由层在 <em>worker</em> 线程中调用资源方法，并在数据可用时写入响应。到目前为止，还没有什么新的或突出的。下图描述了这种行为。在这种情况下，应用程序代码是在工作线程上调用的，而业务逻辑会阻塞该线程。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/http-blocking-sequence.png" alt="Behavior when using the imperative routes" width="70%"></span></p>
</div>
<div class="paragraph">
<p>但是，如果HTTP请求的目标是一个响应式方法（JAX-RS使用RESTEasy响应式，响应式路由， <code>@Incoming</code> 方法没有注释 <code>@Blocking</code>…），路由层会在I/O线程上调用路由，这会带来很多好处，比如更高的并发性和性能：</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/http-reactive-sequence.png" alt="Behavior when using the reactive routes" width="70%"></span></p>
</div>
<div class="paragraph">
<p>因为Quarkus使用I/O线程来调用代码，所以我们节省了上下文切换，避免了大型线程池管理，从而提高了资源利用率。但是，代码必须 <strong>NOT</strong> 阻塞该线程。为什么？因为，I/O线程用于处理多个并发请求。一旦一个请求的处理因为需要执行一些I/O而无法进行，它就会调度这些I/O，并传递一个延续。它释放可以处理另一个请求的线程。当计划的I/O完成时，继续执行，返回到I/O线程。</p>
</div>
<div class="paragraph">
<p>因此，许多Quarkus组件在设计时都考虑了响应式，比如数据库访问（PostgreSQL, MySQL, Mongo等），应用服务（邮件，模板引擎等），消息传递（Kafka, AMQP等）等等。但是，要完全受益于此模型，应用程序代码应该以非阻塞的方式编写。这就是运用一个响应式API这个终极武器的地方。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mutiny"><a class="anchor" href="#mutiny"></a>Mutiny - 一个响应式编程库</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://github.com/smallrye/smallrye-mutiny">Mutiny</a>是一个响应式编程库，允许表达和组合异步动作。它提供两种类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>io.smallrye.mutiny.Uni</code> - 用于提供0或1结果的异步操作</p>
</li>
<li>
<p><code>io.smallrye.mutiny.Multi</code> - 用于多条目(回压)流</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这两种类型都是惰性的，并且遵循订阅模式。计算只在有实际需要时才开始（即订阅者登记）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">uni.subscribe().with(
    result -&gt; System.out.println("result is " + result),
    failure -&gt; failure.printStackTrace()
);

multi.subscribe().with(
    item -&gt; System.out.println("Got " + item),
    failure -&gt; failure.printStackTrace()
);</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>`Uni` 和 `Multi` 都公开了事件驱动的API：你表达了在给定事件上你想做什么(成功，失败等)。这些API被分成组（操作类型），以使其更具表达性，并避免将100个方法附加到单个类上。主要的操作类型是对失败、完成、操作项、提取或收集它们作出反应。它提供了一种流畅的编码体验，具有可导航的API，并且结果不需要太多关于响应式的知识。</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">httpCall
    .onFailure().recoverWithItem("my fallback");</code></pre>
</div>
</div>
<div class="paragraph">
<p>你可能想知道响应流 (<a href="https://www.reactive-streams.org/)。" class="bare">https://www.reactive-streams.org/)。</a> <code>Multi</code> 实现了响应流 <code>Publisher</code>，因此实现了响应流回压机制。 <code>Uni</code> 没有实现 <code>Publisher</code> ，因为' Uni '的订阅足以表明你对结果感兴趣。由于响应流的订阅/请求仪式更加复杂，所以它再次考虑了更简单、更流畅的API。</p>
</div>
<div class="paragraph">
<p>拥抱来自Quarkus的响应和指令支柱的统一， <code>Uni</code> 和 <code>Multi</code> 都为指令式结构提供了桥梁。例如，你可以将 <code>Multi</code> 转换为 <code>Iterable</code> ，或者 <em>await</em> <code>Uni</code> 生成元素。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Block until the result is available
String result = uni.await().indefinitely();

// Transform an asynchronous stream into a blocking iterable
stream.subscribe().asIterable().forEach(s -&gt; System.out.println("Item is " + s));</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这一点上，如果你是RxJava或Reactor的用户，你可能想知道如何使用你熟悉的 <code>Flowable</code>，<code>Single</code>，<code>Flux</code>，<code>Mono</code>… Mutiny允许从 <code>Unis</code> 和 <code>Multis</code> 到RX Java和Reactor类型的转换：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Maybe&lt;String&gt; maybe = uni.convert().with(UniRxConverters.toMaybe());
Flux&lt;String&gt; flux = multi.convert().with(MultiReactorConverters.toFlux());</code></pre>
</div>
</div>
<div class="paragraph">
<p>但是，Vert.x呢？Vert.x API也可以使用Mutiny类型。下面的代码片段展示了Vert.x Web 客户端的用法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Use io.vertx.mutiny.ext.web.client.WebClient
client = WebClient.create(vertx,
                new WebClientOptions().setDefaultHost("fruityvice.com").setDefaultPort(443).setSsl(true)
                        .setTrustAll(true));
// ...
Uni&lt;JsonObject&gt; uni =
    client.get("/api/fruit/" + name)
        .send()
        .onItem().transform(resp -&gt; {
            if (resp.statusCode() == 200) {
                return resp.bodyAsJsonObject();
            } else {
                return new JsonObject()
                        .put("code", resp.statusCode())
                        .put("message", resp.bodyAsString());
            }
        });</code></pre>
</div>
</div>
<div class="paragraph">
<p>最后但并非最不重要的是，Mutiny内置了与MicroProfile上下文传播的集成，因此您可以在响应管道中传播事务、跟踪数据等。</p>
</div>
<div class="paragraph">
<p>说得够多了，我们动手吧！</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="创建项目"><a class="anchor" href="#创建项目"></a>创建项目</h2>
<div class="sectionbody">
<div class="paragraph">
<p>使用Quarkus实现响应式应用程序有几种方法。在本指南中，我们将使用RESTEasy Reactive，一个受益于Quarkus Reactive引擎的RESTEasy的实现。默认情况下，它调用I/O线程上的HTTP端点。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
虽然可以使用_traditional_ RESTEasy，但需要添加 <code>quarkus-resteasy-mutiny</code> 扩展，该方法仍然会在 <em>worker</em> 线程上调用。因此，虽然它将使用响应式编程，但仍然需要工作线程，这与目的不符。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>创建一个新的Quarkus项目最简单的方法是打开终端并运行以下命令：</p>
</div>
<div class="paragraph">
<p>对于Linux和macOS用户</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn io.quarkus:quarkus-maven-plugin:1.11.7.Final:create \
    -DprojectGroupId=org.acme \
    -DprojectArtifactId=getting-started-reactive \
    -DclassName="org.acme.getting.started.ReactiveGreetingResource" \
    -Dpath="/hello" \
    -Dextensions="resteasy-reactive"
cd getting-started-reactive</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于Windows用户</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果使用cmd，（不要使用正斜杠 <code>\</code>）</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn io.quarkus:quarkus-maven-plugin:1.11.7.Final:create -DprojectGroupId=org.acme -DprojectArtifactId=getting-started-reactive -DclassName="org.acme.getting.started.ReactiveGreetingResource" -Dpath="/hello" -Dextensions="resteasy-reactive"</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>如果使用Powershell，请将 <code>-D</code> 参数用双引号括起来</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn io.quarkus:quarkus-maven-plugin:1.11.7.Final:create "-DprojectGroupId=org.acme" "-DprojectArtifactId=getting-started-reactive" "-DclassName=org.acme.getting.started.ReactiveGreetingResource" "-Dpath=/hello" "-Dextensions=resteasy-reactive"</code></pre>
</div>
</div>
<div class="paragraph">
<p>它会在 `./getting-started-reactive`中生成如下内容：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>关于Maven结构</p>
</li>
<li>
<p>一个 <code>org.acme.quickstart.ReactiveGreetingResource</code> 资源暴露 <code>/hello</code></p>
</li>
<li>
<p>关联的单元测试</p>
</li>
<li>
<p>启动应用程序后，可在 <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code> 上访问登录页面</p>
</li>
<li>
<p>示例 <code>Dockerfile</code> 文件位于 <code>src/main/docker</code>，用于 <code>native</code> 和 <code>jvm</code> 两种模式</p>
</li>
<li>
<p>应用程序配置文件</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="响应式-jax-rs-资源"><a class="anchor" href="#响应式-jax-rs-资源"></a>响应式 JAX-RS 资源</h3>
<div class="paragraph">
<p>在项目创建过程中， <code>src/main/java/org/acme/getting/started/ReactiveGreetingResource.java</code> 文件已经创建了以下内容：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.getting.started;

import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;

@Path("/hello")
public class ReactiveGreetingResource {

    @GET
    @Produces(MediaType.TEXT_PLAIN)
    public String hello() {
        return "Hello RESTEasy Reactive";
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这是一个非常简单的REST端点，在 "/hello"上返回 "Hello RESTEasy Reactive" 请求。当它使用RESTEAsy响应式时，这个方法在I/O线程上被调用。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>要让Quarkus在_worker_线程上调用这个方法，请使用 <code>io.smallrye.common.annotation.Blocking</code> 注释它。你可以在一个方法、类上使用 ' @Blocking '，或者在整个应用中通过注释一个 <code>Application</code> 类来启用它：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import javax.ws.rs.ApplicationPath;
import javax.ws.rs.core.Application;
import io.smallrye.common.annotation.Blocking;

@ApplicationPath("/")
@Blocking
public class RestBlockingApplication extends Application {
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>现在让我们创建一个 <code>ReactiveGreetingService</code> 类，包含以下内容：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.getting.started;

import io.smallrye.mutiny.Multi;
import io.smallrye.mutiny.Uni;

import javax.enterprise.context.ApplicationScoped;
import java.time.Duration;

@ApplicationScoped
public class ReactiveGreetingService {

    public Uni&lt;String&gt; greeting(String name) {
        return Uni.createFrom().item(name)
                .onItem().transform(n -&gt; String.format("hello %s", n));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后，编辑 <code>ReactiveGreetingResource</code> 类，以匹配以下内容：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.getting.started;

import javax.inject.Inject;
import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;

import io.smallrye.mutiny.Multi;
import io.smallrye.mutiny.Uni;
import org.reactivestreams.Publisher;

@Path("/hello")
public class ReactiveGreetingResource {

    @Inject
    ReactiveGreetingService service;

    @GET
    @Produces(MediaType.TEXT_PLAIN)
    @Path("/greeting/{name}")
    public Uni&lt;String&gt; greeting(String name) {
        return service.greeting(name);
    }

    @GET
    @Produces(MediaType.TEXT_PLAIN)
    public String hello() {
        return "hello";
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ReactiveGreetingService</code> 类包含一个生成 <code>Uni</code> 的简单方法。虽然在这个例子中，产生的条目是立即发出的，你可以想象任何异步API产生一个 <code>Uni</code>。我们将在本指南的后面讨论这个问题。</p>
</div>
<div class="paragraph">
<p>现在，使用以下命令启动应用程序：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw quarkus:dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>运行后，通过打开 <a href="http://localhost:8080/hello/greeting/neo" class="bare">http://localhost:8080/hello/greeting/neo</a> 检查您是否得到了预期的问候信息。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="处理流"><a class="anchor" href="#处理流"></a>处理流</h2>
<div class="sectionbody">
<div class="paragraph">
<p>到目前为止，我们只返回一个异步结果。在本节中，我们使用传输多个条目的流来扩展应用程序。这些数据流可以来自Kafka或任何其他数据源，但为了简单起见，我们只生成周期性的问候消息。</p>
</div>
<div class="paragraph">
<p>在 <code>ReactiveGreetingService</code> 中，添加以下方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public Multi&lt;String&gt; greetings(int count, String name) {
  return Multi.createFrom().ticks().every(Duration.ofSeconds(1))
        .onItem().transform(n -&gt; String.format("hello %s - %d", name, n))
        .transform().byTakingFirstItems(count);
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
你可能需要添加 <code>import io.smallrye.mutiny.Multi;</code> 和 <code>import java.time.Duration;</code> 语句。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>它每秒钟生成一条问候信息，并在 <code>count</code> 信息后停止。</p>
</div>
<div class="paragraph">
<p>在 <code>ReactiveGreetingResource</code> 中添加以下方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@GET
@Produces(MediaType.APPLICATION_JSON)
@Path("/greeting/{count}/{name}")
public Multi&lt;String&gt; greetings(int count, String name) {
  return service.greetings(count, name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个端点将项目以JSON数组的形式发送给客户端。消息的名称和数量用路径参数进行参数化。</p>
</div>
<div class="paragraph">
<p>所以调用端点会产生如下结果：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ curl http://localhost:8080/hello/greeting/3/neo
["hello neo - 0", "hello neo - 1", "hello neo - 2"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>我们也可以通过返回一个 <code>Multi</code> 来生成服务器发送的事件响应：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@GET
@Produces(MediaType.SERVER_SENT_EVENTS)
@RestSseElementType(MediaType.TEXT_PLAIN)
@Path("/stream/{count}/{name}")
public Multi&lt;String&gt; greetingsAsStream(int count, String name) {
    return service.greetings(count, name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>与前面代码片段唯一的区别是生成的类型和指示每个事件类型的 <code>@RestSseElementType</code> 注解。由于 <code>@Produces</code> 注解定义了 <code>SERVER_SENT_EVENTS</code>，JAX-RS需要它知道每个（嵌套）事件的内容类型。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
你可能需要添加 <code>import org.jboss.resteasy.reactive.RestSseElementType;</code> 语句。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>你可以使用以下命令看到结果：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ curl -N http://localhost:8080/hello/stream/5/neo
data: hello neo - 0

data: hello neo - 1

data: hello neo - 2

data: hello neo - 3

data: hello neo - 4</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="使用响应式-api"><a class="anchor" href="#使用响应式-api"></a>使用响应式 API</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="使用quarkus响应式api"><a class="anchor" href="#使用quarkus响应式api"></a>使用Quarkus响应式API</h3>
<div class="paragraph">
<p>Quarkus使用Mutiny模型提供了许多响应式API。在本节中，我们将看到如何使用响应式PostgreSQL驱动程序以一种非阻塞和响应式的方式与数据库交互。</p>
</div>
<div class="paragraph">
<p>使用以下命令创建一个新项目：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn io.quarkus:quarkus-maven-plugin:1.11.7.Final:create \
    -DprojectGroupId=org.acme \
    -DprojectArtifactId=getting-started-reactive-crud \
    -DclassName="org.acme.reactive.crud.FruitResource" \
    -Dpath="/fruits" \
    -Dextensions="resteasy-reactive,resteasy-reactive-jackson,reactive-pg-client"
cd getting-started-reactive-crud</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个应用程序与一个PostgreSQL数据库交互，所以你需要一个：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run --ulimit memlock=-1:-1 -it --rm=true --memory-swappiness=0 \
           --name postgres-quarkus-reactive -e POSTGRES_USER=quarkus_test \
           -e POSTGRES_PASSWORD=quarkus_test -e POSTGRES_DB=quarkus_test \
           -p 5432:5432 postgres:11.2</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后，让我们配置数据源。打开 <code>src/main/resources/application.properties</code> 并添加以下内容：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.datasource.db-kind=postgresql
quarkus.datasource.username=quarkus_test
quarkus.datasource.password=quarkus_test
quarkus.datasource.reactive.url=postgresql://localhost:5432/quarkus_test
myapp.schema.create=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>第3行定义数据源。最后一行将在应用程序中用于指示在应用程序初始化时是否插入一些条目。</p>
</div>
<div class="paragraph">
<p>现在，让我们创建 <em>entity</em>。创建 <code>org.acme.reactive.crud.Fruit</code> 类具有以下内容：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.reactive.crud;

import io.smallrye.mutiny.Multi;
import io.smallrye.mutiny.Uni;
import io.vertx.mutiny.pgclient.PgPool;
import io.vertx.mutiny.sqlclient.Row;
import io.vertx.mutiny.sqlclient.RowSet;
import io.vertx.mutiny.sqlclient.Tuple;

import java.util.stream.StreamSupport;

public class Fruit {

    public Long id;

    public String name;

    public Fruit() {
        // default constructor.
    }

    public Fruit(String name) {
        this.name = name;
    }

    public Fruit(Long id, String name) {
        this.id = id;
        this.name = name;
    }

    public static Multi&lt;Fruit&gt; findAll(PgPool client) {
        return client.query("SELECT id, name FROM fruits ORDER BY name ASC").execute()
                // Create a Multi from the set of rows:
                .onItem().transformToMulti(set -&gt; Multi.createFrom().items(() -&gt; StreamSupport.stream(set.spliterator(), false)))
                // For each row create a fruit instance
                .onItem().transform(Fruit::from);
    }

    public static Uni&lt;Fruit&gt; findById(PgPool client, Long id) {
        return client.preparedQuery("SELECT id, name FROM fruits WHERE id = $1").execute(Tuple.of(id))
                .onItem().transform(RowSet::iterator)
                .onItem().transform(iterator -&gt; iterator.hasNext() ? from(iterator.next()) : null);
    }

    public Uni&lt;Long&gt; save(PgPool client) {
        return client.preparedQuery("INSERT INTO fruits (name) VALUES ($1) RETURNING (id)").execute(Tuple.of(name))
                .onItem().transform(pgRowSet -&gt; pgRowSet.iterator().next().getLong("id"));
    }

    public Uni&lt;Boolean&gt; update(PgPool client) {
        return client.preparedQuery("UPDATE fruits SET name = $1 WHERE id = $2").execute(Tuple.of(name, id))
                .onItem().transform(pgRowSet -&gt; pgRowSet.rowCount() == 1);
    }

    public static Uni&lt;Boolean&gt; delete(PgPool client, Long id) {
        return client.preparedQuery("DELETE FROM fruits WHERE id = $1").execute(Tuple.of(id))
                .onItem().transform(pgRowSet -&gt; pgRowSet.rowCount() == 1);
    }

    private static Fruit from(Row row) {
        return new Fruit(row.getLong("id"), row.getString("name"));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个 <em>entity</em> 包含一些字段和方法，用于从数据库中查找、更新和删除行。当检索到结果时，所生成的项被异步触发，这些方法返回 <code>Unis</code> 或 <code>Multis</code> 。注意，响应式PostgreSQL客户端已经提供了 <code>Uni</code> 和 <code>Multi</code> 实例。因此，您只需将来自数据库的结果转换为 <em>business-friendly</em> 对象。</p>
</div>
<div class="paragraph">
<p>为了在应用程序启动时初始化数据库，我们将创建一个名为 <code>DBInit</code> 的类，其内容如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.reactive.crud;

import io.quarkus.runtime.StartupEvent;
import io.vertx.mutiny.pgclient.PgPool;
import org.eclipse.microprofile.config.inject.ConfigProperty;

import javax.enterprise.context.ApplicationScoped;
import javax.enterprise.event.Observes;

@ApplicationScoped
public class DBInit {

    private final PgPool client;
    private final boolean schemaCreate;

    public DBInit(PgPool client, @ConfigProperty(name = "myapp.schema.create", defaultValue = "true") boolean schemaCreate) {
        this.client = client;
        this.schemaCreate = schemaCreate;
    }

    void onStart(@Observes StartupEvent ev) {
        if (schemaCreate) {
            initdb();
        }
    }

    private void initdb() {
        client.query("DROP TABLE IF EXISTS fruits").execute()
                .flatMap(r -&gt; client.query("CREATE TABLE fruits (id SERIAL PRIMARY KEY, name TEXT NOT NULL)").execute())
                .flatMap(r -&gt; client.query("INSERT INTO fruits (name) VALUES ('Kiwi')").execute())
                .flatMap(r -&gt; client.query("INSERT INTO fruits (name) VALUES ('Durian')").execute())
                .flatMap(r -&gt; client.query("INSERT INTO fruits (name) VALUES ('Pomelo')").execute())
                .flatMap(r -&gt; client.query("INSERT INTO fruits (name) VALUES ('Lychee')").execute())
                .await().indefinitely();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后，让我们在 <code>FruitResource</code> 中使用这个 <code>Fruit</code> 类。编辑 <code>FruitResource</code> 类，匹配以下内容：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.reactive.crud;

import java.net.URI;

import javax.ws.rs.Consumes;
import javax.ws.rs.DELETE;
import javax.ws.rs.GET;
import javax.ws.rs.POST;
import javax.ws.rs.PUT;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;
import javax.ws.rs.core.Response;
import javax.ws.rs.core.Response.ResponseBuilder;
import javax.ws.rs.core.Response.Status;

import io.smallrye.mutiny.Multi;
import io.smallrye.mutiny.Uni;
import io.vertx.mutiny.pgclient.PgPool;

@Path("fruits")
@Produces(MediaType.APPLICATION_JSON)
@Consumes(MediaType.APPLICATION_JSON)
public class FruitResource {

    private final PgPool client;

    public FruitResource(PgPool client) {
        this.client = client;
    }

    private void initdb() {
        client.query("DROP TABLE IF EXISTS fruits").execute()
                .flatMap(r -&gt; client.query("CREATE TABLE fruits (id SERIAL PRIMARY KEY, name TEXT NOT NULL)").execute())
                .flatMap(r -&gt; client.query("INSERT INTO fruits (name) VALUES ('Kiwi')").execute())
                .flatMap(r -&gt; client.query("INSERT INTO fruits (name) VALUES ('Durian')").execute())
                .flatMap(r -&gt; client.query("INSERT INTO fruits (name) VALUES ('Pomelo')").execute())
                .flatMap(r -&gt; client.query("INSERT INTO fruits (name) VALUES ('Lychee')").execute())
                .await().indefinitely();
    }

    @GET
    public Multi&lt;Fruit&gt; get() {
        return Fruit.findAll(client);
    }

    @GET
    @Path("{id}")
    public Uni&lt;Response&gt; getSingle(Long id) {
        return Fruit.findById(client, id)
                .onItem().transform(fruit -&gt; fruit != null ? Response.ok(fruit) : Response.status(Status.NOT_FOUND))
                .onItem().transform(ResponseBuilder::build);
    }

    @POST
    public Uni&lt;Response&gt; create(Fruit fruit) {
        return fruit.save(client)
                .onItem().transform(id -&gt; URI.create("/fruits/" + id))
                .onItem().transform(uri -&gt; Response.created(uri).build());
    }

    @PUT
    @Path("{id}")
    public Uni&lt;Response&gt; update(Long id, Fruit fruit) {
        return fruit.update(client)
                .onItem().transform(updated -&gt; updated ? Status.OK : Status.NOT_FOUND)
                .onItem().transform(status -&gt; Response.status(status).build());
    }

    @DELETE
    @Path("{id}")
    public Uni&lt;Response&gt; delete(Long id) {
        return Fruit.delete(client, id)
                .onItem().transform(deleted -&gt; deleted ? Status.NO_CONTENT : Status.NOT_FOUND)
                .onItem().transform(status -&gt; Response.status(status).build());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个资源根据 <code>Fruit</code> 类产生的结果返回 <code>Uni</code> 和 <code>Multi</code> 实例。</p>
</div>
</div>
<div class="sect2">
<h3 id="使用-vert-x-客户端"><a class="anchor" href="#使用-vert-x-客户端"></a>使用 Vert.x 客户端</h3>
<div class="paragraph">
<p>前面的示例使用了Quarkus提供的_service_。同样，你也可以直接使用Vert.x客户端。</p>
</div>
<div class="paragraph">
<p>首先，确保存在 <code>quarkus-vertx</code> 扩展。如果没有激活扩展，请执行如下命令来激活：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn io.quarkus:quarkus-maven-plugin:1.11.7.Final:add-extensions \
    -Dextensions=vertx</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者手动将 <code>quarkus-vertx</code> 添加到依赖项中。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
	&lt;groupId&gt;io.quarkus&lt;/groupId&gt;
	&lt;artifactId&gt;quarkus-vertx&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>有一个Mutiny 版本的Vert.x的API。这个API被分为几个可以独立导入的工件：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">项目包名:工程名</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.smallrye.reactive:smallrye-mutiny-vertx-core</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mutiny API for Vert.x Core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.smallrye.reactive:smallrye-mutiny-vertx-mail-client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mutiny API for the Vert.x Mail Client</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.smallrye.reactive:smallrye-mutiny-vertx-web-client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mutiny API for the Vert.x Web Client</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.smallrye.reactive:smallrye-mutiny-vertx-mongo-client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mutiny API for the Vert.x Mongo Client</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.smallrye.reactive:smallrye-mutiny-vertx-redis-client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mutiny API for the Vert.x Redis Client</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.smallrye.reactive:smallrye-mutiny-vertx-cassandra-client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mutiny API for the Vert.x Cassandra Client</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.smallrye.reactive:smallrye-mutiny-vertx-consul-client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mutiny API for the Vert.x Consul Client</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.smallrye.reactive:smallrye-mutiny-vertx-kafka-client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mutiny API for the Vert.x Kafka Client</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.smallrye.reactive:smallrye-mutiny-vertx-amqp-client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mutiny API for the Vert.x AMQP Client</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.smallrye.reactive:smallrye-mutiny-vertx-rabbitmq-client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mutiny API for the Vert.x RabbitMQ Client</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>您还可以在 <a href="http://smallrye.io/smallrye-reactive-utils/apidocs/" class="bare">http://smallrye.io/smallrye-reactive-utils/apidocs/</a> 上查看可用的API。</p>
</div>
<div class="paragraph">
<p>我们举个例子。添加以下依赖到你的应用程序：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.smallrye.reactive&lt;/groupId&gt;
    &lt;artifactId&gt;smallrye-mutiny-vertx-web-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>它提供了Vert.x Web客户端的Mutiny API。然后，您可以使用如下web客户端：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.vertx;

import io.smallrye.mutiny.Uni;
import io.vertx.core.json.JsonObject;
import io.vertx.ext.web.client.WebClientOptions;
import io.vertx.mutiny.core.Vertx;
import io.vertx.mutiny.ext.web.client.WebClient;
import org.jboss.resteasy.annotations.jaxrs.PathParam;

import javax.annotation.PostConstruct;
import javax.inject.Inject;
import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;

@Path("/fruit-data")
public class ResourceUsingWebClient {

    @Inject
    Vertx vertx;

    private WebClient client;

    @PostConstruct
    void initialize() {
        this.client = WebClient.create(vertx,
                new WebClientOptions().setDefaultHost("fruityvice.com").setDefaultPort(443).setSsl(true)
                        .setTrustAll(true));
    }

    @GET
    @Produces(MediaType.APPLICATION_JSON)
    @Path("/{name}")
    public Uni&lt;JsonObject&gt; getFruitData(@PathParam("name") String name) {
        return client.get("/api/fruit/" + name)
                .send()
                .map(resp -&gt; {
                    if (resp.statusCode() == 200) {
                        return resp.bodyAsJsonObject();
                    } else {
                        return new JsonObject()
                                .put("code", resp.statusCode())
                                .put("message", resp.bodyAsString());
                    }
                });
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>有两点很重要：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>注入的 Vert.x 实例是 <code>io.vertx.mutiny.core.Vertx</code> 类型，它是 Vert.x 的 Mutiny 变量；</p>
</li>
<li>
<p>Web客户端是从 <code>io.vertx.mutiny.ext.web.client.WebClient</code> 创建的。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Mutiny 版本的 Vert.x API 还提供：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>andAwait</code> 方法，例如 <code>sendAndAwait</code>。 <code>andAwait</code> 表示调用方线程被阻塞，直到结果可用。注意不要用这种方式阻塞事件循环/ IO线程。</p>
</li>
<li>
<p><code>andForget</code> 方法，如 <code>writeAndForget</code>。 <code>andForget</code> 可用于返回 <code>Uni</code> 的方法。 <code>andForget</code> 表示你不需要结果的 <code>Uni</code> 来表示操作的成功或失败。但是请记住，如果您不订阅，操作将不会被触发。 <code>andForget</code> 为您管理这个和管理订阅。</p>
</li>
<li>
<p><code>toMulti</code> 方法允许将一个 Vert.x <code>ReadStream</code> 转换为 <code>Multi</code></p>
</li>
<li>
<p><code>toBlockingIterable</code> / <code>toBlockingStream</code> 方法允许转换Vert.x <code>ReadStream</code> 写入阻塞的可迭代对象或阻塞的 <code>java.util.Stream</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="使用-rxjava-或-reactor-api"><a class="anchor" href="#使用-rxjava-或-reactor-api"></a>使用 RxJava 或 Reactor API</h3>
<div class="paragraph">
<p>Mutiny提供工具来将 RxJava 2 和 Project Reactor 类型转换为 <code>Uni</code> 和 <code>Multi</code>。</p>
</div>
<div class="paragraph">
<p>RxJava 2转换器有以下依赖项：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.smallrye.reactive&lt;/groupId&gt;
    &lt;artifactId&gt;mutiny-rxjava&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>因此，如果你有一个返回RxJava 2类型 (<code>Completable</code>, <code>Single</code>, <code>Maybe</code>, <code>Observable</code>, <code>Flowable</code>) 的API，你可以创建 <code>Unis</code> 和 <code>Multis</code> ，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.smallrye.mutiny.converters.multi.MultiRxConverters;
import io.smallrye.mutiny.converters.uni.UniRxConverters;
// ...
Uni&lt;Void&gt; uniFromCompletable = Uni.createFrom().converter(UniRxConverters.fromCompletable(), completable);
Uni&lt;String&gt; uniFromSingle = Uni.createFrom().converter(UniRxConverters.fromSingle(), single);
Uni&lt;String&gt; uniFromMaybe = Uni.createFrom().converter(UniRxConverters.fromMaybe(), maybe);
Uni&lt;String&gt; uniFromEmptyMaybe = Uni.createFrom().converter(UniRxConverters.fromMaybe(), emptyMaybe);
Uni&lt;String&gt; uniFromObservable = Uni.createFrom().converter(UniRxConverters.fromObservable(), observable);
Uni&lt;String&gt; uniFromFlowable = Uni.createFrom().converter(UniRxConverters.fromFlowable(), flowable);

Multi&lt;Void&gt; multiFromCompletable = Multi.createFrom().converter(MultiRxConverters.fromCompletable(), completable);
Multi&lt;String&gt; multiFromSingle = Multi.createFrom().converter(MultiRxConverters.fromSingle(), single);
Multi&lt;String&gt; multiFromMaybe = Multi.createFrom().converter(MultiRxConverters.fromMaybe(), maybe);
Multi&lt;String&gt; multiFromEmptyMaybe = Multi.createFrom().converter(MultiRxConverters.fromMaybe(), emptyMaybe);
Multi&lt;String&gt; multiFromObservable = Multi.createFrom().converter(MultiRxConverters.fromObservable(), observable);
Multi&lt;String&gt; multiFromFlowable = Multi.createFrom().converter(MultiRxConverters.fromFlowable(), flowable);</code></pre>
</div>
</div>
<div class="paragraph">
<p>你也可以将 <code>Unis</code> 和 <code>Multis</code> 转换成 RxJava 类型：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Completable completable = uni.convert().with(UniRxConverters.toCompletable());
Single&lt;Optional&lt;String&gt;&gt; single = uni.convert().with(UniRxConverters.toSingle());
Single&lt;String&gt; single2 = uni.convert().with(UniRxConverters.toSingle().failOnNull());
Maybe&lt;String&gt; maybe = uni.convert().with(UniRxConverters.toMaybe());
Observable&lt;String&gt; observable = uni.convert().with(UniRxConverters.toObservable());
Flowable&lt;String&gt; flowable = uni.convert().with(UniRxConverters.toFlowable());
// ...
Completable completable = multi.convert().with(MultiRxConverters.toCompletable());
Single&lt;Optional&lt;String&gt;&gt; single = multi.convert().with(MultiRxConverters.toSingle());
Single&lt;String&gt; single2 = multi.convert().with(MultiRxConverters
        .toSingle().onEmptyThrow(() -&gt; new Exception("D'oh!")));
Maybe&lt;String&gt; maybe = multi.convert().with(MultiRxConverters.toMaybe());
Observable&lt;String&gt; observable = multi.convert().with(MultiRxConverters.toObservable());
Flowable&lt;String&gt; flowable = multi.convert().with(MultiRxConverters.toFlowable());</code></pre>
</div>
</div>
<div class="paragraph">
<p>项目 Reactor 转换器在以下依赖项中可用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.smallrye.reactive&lt;/groupId&gt;
    &lt;artifactId&gt;mutiny-reactor&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>那么如果你有一个API返回 Reactor 类型 (<code>Mono</code>, <code>Flux</code>)，你可以创建 <code>Unis</code> 和 <code>Multis</code> 如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.smallrye.mutiny.converters.multi.MultiReactorConverters;
import io.smallrye.mutiny.converters.uni.UniReactorConverters;
// ...
Uni&lt;String&gt; uniFromMono = Uni.createFrom().converter(UniReactorConverters.fromMono(), mono);
Uni&lt;String&gt; uniFromFlux = Uni.createFrom().converter(UniReactorConverters.fromFlux(), flux);

Multi&lt;String&gt; multiFromMono = Multi.createFrom().converter(MultiReactorConverters.fromMono(), mono);
Multi&lt;String&gt; multiFromFlux = Multi.createFrom().converter(MultiReactorConverters.fromFlux(), flux);</code></pre>
</div>
</div>
<div class="paragraph">
<p>你也可以将 <code>Unis</code> 和 <code>Multis</code> 转换为 Reactor 类型：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Mono&lt;String&gt; mono = uni.convert().with(UniReactorConverters.toMono());
Flux&lt;String&gt; flux = uni.convert().with(UniReactorConverters.toFlux());

Mono&lt;String&gt; mono2 = multi.convert().with(MultiReactorConverters.toMono());
Flux&lt;String&gt; flux2 = multi.convert().with(MultiReactorConverters.toFlux());</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="使用completionstages或publisher-api"><a class="anchor" href="#使用completionstages或publisher-api"></a>使用CompletionStages或Publisher API</h3>
<div class="paragraph">
<p>如果你面对的是使用 <code>CompletionStage</code>, <code>CompletableFuture</code> 或 <code>Publisher</code> 的API，你可以来回转换。首先， <code>Uni</code> 和 <code>Multi</code> 都可以从 <code>CompletionStage</code> 或 `Supplier&lt;CompletionStage&gt;`创建。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">CompletableFuture&lt;String&gt; future = Uni
        // Create from a Completion Stage
        .createFrom().completionStage(CompletableFuture.supplyAsync(() -&gt; "hello"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>在 <code>Uni</code> 上，你也可以使用 <code>subscribeAsCompletionStage()</code> 来产生一个 <code>CompletionStage</code> 。 <code>CompletionStage</code> 会获得由 <code>Uni</code> 发出的条目或失败。</p>
</div>
<div class="paragraph">
<p>你也可以使用 <code>createFrom().publisher(Publisher)</code> 从 <code>Publisher</code> 的实例中创建 <code>Unis</code> 和 <code>Multis</code> 。你可以使用 <code>toMulti</code> 将 <code>Uni</code> 转换为 <code>Publisher</code> 。事实上， <code>Multi</code> 实现了 <code>Publisher</code>。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="下一步做什么"><a class="anchor" href="#下一步做什么"></a>下一步做什么？</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本指南是关于Quarkus响应式的介绍。Quarkus 的许多特性已经具有了响应式风格。下面列出了一些例子：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="rest-json#reactive">使用Mutiny和RestEasy</a></p>
</li>
<li>
<p><a href="mailer">发送电邮件</a></p>
</li>
<li>
<p><a href="mongodb#reactive">使用 MongoDB</a> 和 <a href="mongodb-panache#reactive">MongoDB 和Panache</a></p>
</li>
<li>
<p><a href="reactive-sql-clients">Reactive 数据库客户端</a></p>
</li>
<li>
<p><a href="vertx">使用 Vert.x</a></p>
</li>
<li>
<p><a href="kafka">与Kafka交互</a> 和 <a href="amqp">与AMQP交互</a></p>
</li>
<li>
<p><a href="neo4j#reactive">使用Neo4J</a></p>
</li>
<li>
<p><a href="reactive-routes">使用响应式路由</a></p>
</li>
</ul>
</div>
</div>
</div>
    </div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus是开放的。这个项目的所有依赖关系在<a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a>许可或者可以在有互换性的许可下使用。<br /><br />这个网站使用 <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> 来构建，代码托管于<a href='https://pages.github.com/' target='_blank'>Github Pages</a>，完全开源。当需要改善和丰富内容的时候，我们会从 <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>网站项目</a>创建分支，然后修正并发布到网站。</p>

    
      <div class="width-1-12 project-links">
        <span>导航栏</span>
        <ul class="footer-links">
          
            <li><a href="/">主页</a></li>
          
            <li><a href="/about">关于Quarkus</a></li>
          
            <li><a href="/blog">博客</a></li>
          
            <li><a href="/insights">播客</a></li>
          
            <li><a href="/events">活动</a></li>
          
            <li><a href="/newsletter">新闻</a></li>
          
            <li><a href="/publications">发表</a></li>
          
            <li><a href="/awards">获奖</a></li>
          
            <li><a href="/security">安全</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>社交媒体</span>
        <ul class="footer-links">
          
            <li><a href="https://twitter.com/quarkusio">Twitter</a></li>
          
            <li><a href="https://www.facebook.com/quarkusio">Facebook</a></li>
          
            <li><a href="https://www.linkedin.com/company/quarkusio/">Linkedin</a></li>
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg">Youtube</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>协助</span>
        <ul class="footer-links">
          
            <li><a href="/support">支持</a></li>
          
            <li><a href="/guides">指南</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
            <li><a href="/get-started">入门</a></li>
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus">Stack Overflow</a></li>
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions">讨论</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">开发邮件列表</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
            <li><a href="https://quarkus.io/">English</a></li>
          
            <li><a href="https://es.quarkus.io/">Español</a></li>
          
            <li><a href="https://ja.quarkus.io/">日本語</a></li>
          
            <li><a href="https://cn.quarkus.io/">简体中文</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus由社区项目组成：</span>
        <ul class="footer-links">
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://code.quarkus.io/" target="_blank">更多...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/search-filter.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
</body>

</html>
